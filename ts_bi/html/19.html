
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h3 id="articleHeader1" style="margin-left: 0px;">开篇介绍</h3><p>在 SQL Server 2012 之前的版本中，在包启动之后，如果我们想改变一个变量的值的话，我们是需要通过 Script Task 去完成赋值，或者使用 Execute SQL Task 的 Output 或者 ReturnValue 方式给一个变量来赋值。</p><p>但是现在在 SQL Server 2012 版本中我们现在直接有了一个新的控件 Expression Task，我们直接可以通过 Expression Task 来完成对包变量的赋值操作。</p><h4 id="articleHeader2" style="margin-left: 0px;">阶段一 包运行之前变量的赋值</h4><p>假设我们定义了一个包变量表示一个输出文件的完全路径，PV_FILE_PATH 的 Value 默认是 D:\BIWORKSPACE_FILE\TS_BIWORK_SSIS\OUTPUT_DIRECTORY\015\2014_09_11_BIWORK.csv</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211528306129891.png"/></p><p>由于我们希望这个文件每天在输出的时候，它文件路径中的日期部分能跟着改编成当前天的时间 - D:\BIWORKSPACE_FILE\TS_BIWORK_SSIS\OUTPUT_DIRECTORY\015\2014_09_21_BIWORK.csv。</p><p>那么这样就需要对这个变量的一个属性就行修改，EvaluateAsExpression 属性要设置为 True 并为这个变量提供表达式。(实际上也可以不用设置 EvaluateAsExpression，因为只要给 Expression 表达式设置了，它的这个属性会自行提示修改)。</p><p>可以在属性中修改这 EvaluateAsExpression 为 True，然后点击下面的 Expression，或者就上图中的 Expression 后点击也一样可以。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211529011907383.png"/></p><p>利用表达式来修改变量的值，这样在包运行的时候变量的值就由这个表达式自动计算得来。输入下面的表达式，点击 Evaluate Expression 查看。</p><pre><code><span style='font-family: "Microsoft YaHei"; line-height: 1.5 !important;'><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>D:\\BIWORKSPACE_FILE\\TS_BIWORK_SSIS\\OUTPUT_DIRECTORY\\015\\</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><br/>
+ <span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>REPLACE</span>( (DT_WSTR, <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>30</span>)(DT_DBDATE)GETDATE() ,<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>-</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>,<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>_</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>) + <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>_BIWORK.csv</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span></span></code></pre><p style="margin-left: auto;"><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211530026597038.png"/></p><p>有三点要注意：</p><ol><li>文件路径中的单斜杠在表达式中要写成双斜杠</li><li>这个变量是字符串类型，因此表达式中整个计算结果必须是字符串类型，用双引号括起来。</li><li>GETDATE() 获取日期，转换成时间类型之后再变为字符串，最后由 Replace 完成日期中 2014-09-21 到 2014_09_21 的转变。</li></ol><h4 id="articleHeader3" style="margin-left: 0px;">阶段二 Task 返回值的赋值</h4><p>有很多时候我们在处理一些时间数据的时候，比如运行期间获得一个日期 2014-09-21，我们需要将这个时间输出到某一个文件。在输出到文件的同时，可能有这样的需求：需要同时获取这个时间对应的月份，例如英文时间序列 Jan, Feb, Mar, Apr, May 或者需要获取这个时间对应的星期几，例如 Sunday, Monday, Tuesday 等等。这个时候就可以利用 Expression Task 给某一个变量赋值，变量拿到值之后就可以用在其它的 Task 中了。</p><p>新添加三个变量- PV_DATE，PV_MONTH_NAME 和 PV_DAY_NAME，第一个是时间类型，后面两个是字符串类型。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211552120962920.png"/></p><p>我们假设在包中有很多的 Task，其中有一个 Execute SQL Task 返回了一个时间，这个时间可能是通过某查询返回的，我们需要先将这个时间赋值给 PV_DATE。</p><pre><code><span style='font-family: "Microsoft YaHei"; line-height: 1.5 !important;'><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>SELECT</span> <span style='color: rgb(255, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>GETDATE</span>() <span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>AS</span> XXXDATE</span></code></pre><p style="margin-left: auto;"><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211552262378467.png"/></p><p>Result Set 中取返回的第一列的值赋值给变量 PV_DATE。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211552382067644.png"/></p><h4 id="articleHeader4" style="margin-left: 0px;">阶段三 包运行中通过 Expression Task 为变量赋值</h4><p>拖放两个 Expression Task 控件，并放到 Sequence Container 中。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211553413933040.png"/></p><p>双击编辑 ET_GET_DAY_NAME，并使用用户自定义变量。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211553523008173.png"/></p><p>Expression 中的内容为：</p><pre><code><span style='font-family: "Microsoft YaHei"; line-height: 1.5 !important;'>@[User::PV_DAY_NAME]=<br/>
<span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>DATEPART</span>(<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>dw</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>,@[User::PV_DATE] )== <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>1</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Sunday</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>:<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>DATEPART</span>(<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>dw</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>,@[User::PV_DATE] )== <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>2</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Monday</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>:<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>DATEPART</span>(<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>dw</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>,@[User::PV_DATE] )== <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>3</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Tuesday</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>:<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>DATEPART</span>(<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>dw</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>,@[User::PV_DATE] )== <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>4</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Wednesday</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>:<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>DATEPART</span>(<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>dw</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>,@[User::PV_DATE] )== <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>5</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Thursday</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>:<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>DATEPART</span>(<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>dw</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>,@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>6</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Friday</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>:<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>DATEPART</span>(<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>dw</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>,@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>7</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Saturday</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>:<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>""</span></span></code></pre><p style="margin-left: auto;">一个 Expression Task 中只配置一个变量，编辑 ET_GET_MONTH_NAME Task。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211554498934246.png"/></p><pre><code><span style='font-family: "Microsoft YaHei"; line-height: 1.5 !important;'>@[User::PV_MONTH_NAME]=<br/>
<span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>1</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Jan</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> : <br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>2</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Feb</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>3</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Mar</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>4</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Apr</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>5</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>May</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>6</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Jun</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>7</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Jul</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>8</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Aug</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>9</span> ?   <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Sep</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>10</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Oct</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>11</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Nov</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> :<br/>
</span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>MONTH</span>(@[User::PV_DATE]) == <span style='color: rgb(128, 0, 128); font-family: "Courier New" !important; line-height: 1.5 !important;'>12</span> ? <span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>Dec</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>:<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>""</span></span></code></pre><p style="margin-left: auto;">添加一个 Script Task 来展示一下这几个变量的值。</p><p style="margin-left: auto;"><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211555431282348.png"/></p><p>代码如下-</p><pre><code><span style='font-family: "Microsoft YaHei"; line-height: 1.5 !important;'><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>public</span> <span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>void</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> Main()<br/>
  {<br/>
   </span><span style='color: rgb(0, 128, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>//</span><span style='color: rgb(0, 128, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'> TODO: Add your code here<br/>
            </span><span style='color: rgb(0, 128, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>//</span><span style='color: rgb(0, 128, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>User::PV_DATE,User::PV_DAY_NAME,User::PV_FILE_PATH,User::PV_MONTH_NAME</span><br/>
            <span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>string</span> filePath = Dts.Variables[<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>User::PV_FILE_PATH</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>].Value.ToString();<br/>
            </span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>string</span> sqlDate = Dts.Variables[<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>User::PV_DATE</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>].Value.ToString();<br/>
            </span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>string</span> day = Dts.Variables[<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>User::PV_DAY_NAME</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>].Value.ToString();<br/>
            </span><span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>string</span> month = Dts.Variables[<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>User::PV_MONTH_NAME</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>].Value.ToString();<br/>
<br/>
            MessageBox.Show(</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>File Path - </span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>+filePath+<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>\nSQL Date -</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>+sqlDate+<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>\nMonth - </span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>+month+<span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>\nDay - </span><span style='color: rgb(128, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>"</span>+<span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>day);<br/>
   Dts.TaskResult </span>= (<span style='color: rgb(0, 0, 255); font-family: "Courier New" !important; line-height: 1.5 !important;'>int</span><span style='color: rgb(0, 0, 0); font-family: "Courier New" !important; line-height: 1.5 !important;'>)ScriptResults.Success;<br/>
  }</span></span></code></pre><p style="margin-left: auto;">保存并执行包就可以看到这几个变量的值了，其中:</p><ol><li>File Path - 是包启动就通过表达式赋值的</li><li>Sql Date - 是通过 Execute SQL Task 返回值赋值的</li><li>Day 和 Month - 是通过在包运行期间通过 Executel SQL Task 的动态返回值来完成表达式赋值的。</li></ol><p style="margin-left: auto;"><img alt="" src="http://images.cnitblog.com/blog/477275/201409/211556317848184.png"/></p>
<ul class="aw-upload-file-list">
</ul>
</div>]
</body>
</html>
