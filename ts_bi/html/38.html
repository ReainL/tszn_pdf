
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h3 id="articleHeader1" style="margin-left: 0px;">开篇介绍</h3><p>Execute Process Task 从字面意思上理解就是一个可以执行应用程序的任务，在 SSIS 中可以使用 Execute Process Task 调用应用程序 .exe 或者 .bat 批处理文件，包括使用 JAVA 命令调用 JAVA 应用程序。在实际的 ETL 项目中，考虑到磁盘空间问题，一般使用 Execute Process Task 来归档文件，进行压缩或者解压缩等操作；或者在通过 Send Mail Task 中发送邮件附件文件时，现对文件进行压缩处理；在一些自定义的调度框架中也会使用 Execute Process Task 来控制包的调用等等。</p><h3 id="articleHeader2" style="margin-left: 0px;">Execute Process Task 初体验 - 调用 CMD 命令创建文件夹 </h3><p>在 CMD 中，我们如果要创建一个文件夹，比如在 D:\BIWORKSPACE_FILE\TS_BIWORK_SSIS\OUTPUT_DIRECTORY\023 目录下创建一个 TEST_FOLDER_FROM_CMD 新的文件夹，命令如下图所示：</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051314343784673.png"/></p><p>那么在 SSIS 中，我们是这样来调用的。新建一个包并创建一个 Execute Process Task 任务，配置如下：</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051316198003580.png"/></p><p>C:\Windows\System32\cmd.exe</p><p>/C MD D:\BIWORKSPACE_FILE\TS_BIWORK_SSIS\OUTPUT_DIRECTORY\023\TEST_FOLDER_FROM_EXPT</p><p>程序执行成功 -</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051315003622677.png"/></p><p>在程序中可以看到新创建好的文件夹。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051316382222508.png"/></p><p>当然也可以通过配置变量来实现，这样路径和命令就不会是写死的值了。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051316479872457.png"/></p><p>通过这个小例子，简单的了解了一下 Execute Process Task 的大致作用，下面的两个例子讲解的是如何使用 Execute Process Task 来完成压缩和解压缩的操作。</p><h3 id="articleHeader3" style="margin-left: 0px;">数据文件压缩的操作</h3><p>压缩文件的工具我们选择的是免费的 7-zip - <a href="http://www.7-zip.org/">http://www.7-zip.org/</a></p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051317065974143.png"/></p><p>在我们的测试目录下有这样的一些文件。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051317140345947.png"/></p><p>我们现在需要将它们打包压缩并归档到 ARCHIVE 目录下，新建四个变量：</p><ol><li>PV_EXE_ZIP (7z 压缩程序的路径) -  C:\Program Files (x86)\7-Zip\7z.exe </li><li>PV_EXE_ZIP_SOURCE ( 要压缩文件的路径) - D:\BIWORKSPACE_FILE\TS_BIWORK_SSIS\INPUT_DIRECTORY\023\*</li><li>PV_EXE_ZIP_ARCHIVE (压缩归档的路径) - D:\BIWORKSPACE_FILE\TS_BIWORK_SSIS\OUTPUT_DIRECTORY\023\archive</li><li>PV_EXE_ZIP_CMD (命令行) - "a -t7z " + @[User::PV_EXE_ZIP_ARCHIVE] + "\\BIWORK_ZIP_"+REPLACE( (DT_WSTR, 11) (DT_DBDATE) GETDATE(),"-","_") +" "+ @[User::PV_EXE_ZIP_SOURCE]</li></ol><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051317242226427.png"/></p><p>新建一个 Execute Process Task，修改它的 Expression 如下图所示 - </p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051324290664086.png"/></p><p>也可以在调试阶段先配置好 Executable 和 Arguments，但是实际上在运行时它们的值还是通过上面的 Expression 配置而来的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051324405191052.png"/></p><p>执行完成之后就可以在 OUTPUT 路径下看到压缩包，并且其名称根据表达式自动计算当前时间。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051324510669873.png"/></p><p>双击可以查看压缩包中的内容。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051324598314651.png"/></p><p>把这个压缩包拷贝到 INPUT DIRECTORY 中去，我们下面演示如何对它进行解压缩操作。</p><h3 id="articleHeader4" style="margin-left: 0px;">解压缩操作</h3><p>新建三个变量 - </p><ol><li>PV_EXE_UNZIP_SOURCE - D:\BIWORKSPACE_FILE\TS_BIWORK_SSIS\INPUT_DIRECTORY\023\BIWORK_ZIP_2014_10_05.7z</li><li>PV_EXE_UNZIP_OUTPUT - D:\BIWORKSPACE_FILE\TS_BIWORK_SSIS\OUTPUT_DIRECTORY\023\BIWORK_UNZIP</li><li>PV_EXE_UNZIP_CMD - 它的表达式为 "x " + @[User::PV_EXE_UNZIP_SOURCE] + " -o" + @[User::PV_EXE_UNZIP_OUTPUT] </li></ol><p>新建一个 Expression Task，同样的需要配置它的 Expression。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051325275665158.png"/></p><p>保存并执行 EXPT_UNZIP_FILES，可以看到文件被解压缩出来。 </p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/051325349724421.png"/></p>
</div>]
</body>
</html>
