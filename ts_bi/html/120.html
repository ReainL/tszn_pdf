
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<p>有时需要从一些查询结果里排除掉一些成员，当然平常情况下可以通过 MDX 查询中的 WHERE 条件即 Slicer 切片来完成，同样的这里显示的是如何在切片中排除掉一些成员。</p><p>先看这一个查询 -</p><pre><code><span style="font-family: 'Microsoft Yahei'; font-size: 14px;"><span style="color: #0000ff;">SELECT</span> { <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Reseller Order Count</span><span style="color: #ff0000;">]</span> } <span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">0</span>,<br/>
NON EMPTY {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.MEMBERS }<br/>
DIMENSION PROPERTIES <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">1</span><br/>
<span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Adventure Works</span><span style="color: #ff0000;">]</span></span></code></pre><p><img alt="" src="http://images.cnitblog.com/blog/477275/201311/04233641-525735819e754c4eadcad9a9c82db595.png"/></p><p>上面的查询返回了12个 Promotion 成员，DIMNSION PROPERTIES 关键字用来获取有关成员的属性信息 - Discount Percent。</p><p>可以双击成员查看它们的属性信息，例如双击 No Discount 成员可以看到它的成员属性 -</p><p> <img alt="" src="http://images.cnitblog.com/blog/477275/201311/04233654-2d2387ae9de64398ad5b8ba80c4f67b3.png"/></p><p>下面我们要做的就是排除掉  [Promotion].[Promotion].[Discount Percent]  成员属性值为0，2 和 5 的成员。</p><p> <img alt="" src="http://images.cnitblog.com/blog/477275/201311/04233707-bdfc974e924c4043b8c166249589a682.png"/></p><p> </p><p> <img alt="" src="http://images.cnitblog.com/blog/477275/201311/04233712-fc30b12e996a4b57b3a64067c438581e.png"/></p><p>添加 WHERE 条件</p><pre><code><span style="font-family: 'Microsoft Yahei'; font-size: 14px;"><span style="color: #0000ff;">SELECT</span> { <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Reseller Order Count</span><span style="color: #ff0000;">]</span> } <span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">0</span>,<br/>
NON EMPTY {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.MEMBERS }<br/>
DIMENSION PROPERTIES <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">1</span><br/>
<span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Adventure Works</span><span style="color: #ff0000;">]</span> <br/>
<span style="color: #0000ff;">WHERE</span> ( <span style="color: #808080;">-</span><br/>
               {<br/>
                  <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">0</span><span style="color: #ff0000;">]</span>,<br/>
                  <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">2.E-2</span><span style="color: #ff0000;">]</span>,<br/>
                  <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">5.E-2</span><span style="color: #ff0000;">]</span><br/>
               }<br/>
)</span></code></pre><p>打开 Promotion 维度找到 Discount Percent 然后将 0，2，5 三个值拖放过来，最后用 - 号表示要排除</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201311/04233815-f5dbc60f8c104ac984f4fbfbae1576be.png"/></p><p>最终 'No Discount', 'Volume Discount 11 to 14', 'Volumn Discount 15 to 24' 这几个成员就被排除掉了。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201311/04233833-3126920d8677408eb852a889cf529010.png"/></p><p>在最开始的查询中并没有使用任何的切片 Slicer 去过滤层次结构轴上的任何成员，但是也不需要显示的写出来，因为 SSAS 有一套元组的自动填充规则来将局部元组补充完全。通过 WHERE 条件我们使用到了切片的概念，它实则就是在层次结构轴上排除掉了'No Discount', 'Volumn Discount 11 to 14', 'Volumn Discount 15 to 24' 这几个成员，那么整个 Cube 空间的形成自然也将排除掉由这几个成员与其它层次结构轴构成的轴空间。</p><p>我们也可以使用 Except 函数来实现同样的结果：</p><pre><code><span style="font-family: 'Microsoft Yahei'; font-size: 14px;"><span style="color: #0000ff;">SELECT</span> { <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Reseller Order Count</span><span style="color: #ff0000;">]</span> } <span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">0</span>,<br/>
NON EMPTY {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.MEMBERS }<br/>
DIMENSION PROPERTIES <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">1</span><br/>
<span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Adventure Works</span><span style="color: #ff0000;">]</span> <br/>
<span style="color: #0000ff;">WHERE</span> <span style="color: #0000ff;">EXCEPT</span>(<br/>
                         {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.MEMBERS},<br/>
                         {<br/>
                             <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">0</span><span style="color: #ff0000;">]</span>,<br/>
                             <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">2.E-2</span><span style="color: #ff0000;">]</span>,<br/>
                             <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">5.E-2</span><span style="color: #ff0000;">]</span><br/>
                         }<br/>
  )</span></code></pre><p>EXCEPT ({SET 1},{SET 2}) 函数的作用就是取得 SET 1 没有在 SET 2 中出现的那部分成员形成的集合，注意返回的是 SET 1 中的成员。</p><p>在这个例子中，Discount Percent 属性中定义了 MemberValue 值，因此还可以通过 Filter 函数来实现 NOT IN 的逻辑。</p><pre><code><span style="font-family: 'Microsoft Yahei'; font-size: 14px;"><span style="color: #0000ff;">SELECT</span> { <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Reseller Order Count</span><span style="color: #ff0000;">]</span> } <span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">0</span>,<br/>
NON EMPTY {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.MEMBERS }<br/>
DIMENSION PROPERTIES <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span> <span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">1</span><br/>
<span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Adventure Works</span><span style="color: #ff0000;">]</span> <br/>
<span style="color: #0000ff;">WHERE</span><br/>
(<br/>
   { FILTER(<br/>
                   <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.MEMBERS,<br/>
                   <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Promotion</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Discount Percent</span><span style="color: #ff0000;">]</span>.CurrentMember.MemberValue <span style="color: #808080;">&gt;=</span> <span style="color: #800000; font-weight: bold;">0.1</span><br/>
                )<br/>
   }<br/>
)</span></code></pre><p><img alt="" src="http://images.cnitblog.com/blog/477275/201311/04234019-6d5fe240d7ae4163825215453e18c57c.png"/></p><p>但是要注意，这里在 FILTER 中的条件表达式的前提是 [Promotion].[Discount Percent].CurrentMember.MemberValue 中的值确实是连续的，如果不是连续的已经排过序的值，那么就不可以使用 Filter 来实现这个例子。</p>
</div>]
</body>
</html>
