
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<p>本篇文章记录 SBS 中 MDX 查询原型，可以根据这些查询原型来解决实际项目中的问题。</p><p>1. 查询在 2004年1月2日 - 2004年3月1日之间购买过 Bikes 产品的用户。</p><pre><code><span style="font-family: 'Microsoft Yahei';"><span style="color: #0000ff;">SELECT</span> (<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Product</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Category</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Bikes</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Internet Sales Amount</span><span style="color: #ff0000;">]</span>) <span style="color: #0000ff;">ON</span> COLUMNS,<br/>
       NON EMPTY <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.MEMBERS <span style="color: #0000ff;">ON</span> ROWS<br/>
<span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Step-by-Step</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">WHERE</span> (<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">20040102</span><span style="color: #ff0000;">]</span>:<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">20040301</span><span style="color: #ff0000;">]</span>)</span></code></pre><p>2. 查询在 2004年1月2日 - 2004年3月1日之间购买过 Bikes 或 Clothing 产品的用户。</p><pre><code><span style="font-family: 'Microsoft Yahei';"><span style="color: #0000ff;">SELECT</span> {<br/>
            (<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Product</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Category</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Bikes</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Internet Sales Amount</span><span style="color: #ff0000;">]</span>),<br/>
            (<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Product</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Category</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Clothing</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Internet Sales Amount</span><span style="color: #ff0000;">]</span>)<br/>
       }<span style="color: #0000ff;">ON</span> COLUMNS,<br/>
       NON EMPTY <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.MEMBERS <span style="color: #0000ff;">ON</span> ROWS <br/>
<span style="color: #0000ff;">FROM</span> (<br/>
    <span style="color: #0000ff;">SELECT</span> (<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">20040102</span><span style="color: #ff0000;">]</span>:<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">20040301</span><span style="color: #ff0000;">]</span>) <span style="color: #0000ff;">ON</span> COLUMNS<br/>
    <span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Step-by-Step</span><span style="color: #ff0000;">]</span> <br/>
)</span></code></pre><p>3. 计算2004年3月1日 - 3月4日之前60天购买了 Bikes 或者 Clothing 产品的用户数量。</p><pre><code><span style="font-family: 'Microsoft Yahei';"><span style="color: #0000ff;">WITH</span> <br/>
MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CustomerCounts</span><span style="color: #ff0000;">]</span> <span style="color: #0000ff;">AS</span><br/>
    <span style="color: #008080;">--</span><span style="color: #008080;"> 计算用户总数</span><br/>
    <span style="color: #ff00ff;">COUNT</span>(<br/>
            NONEMPTY (<br/>
                        <span style="color: #008080;">--</span><span style="color: #008080;"> 取购买过 Bikes 的用户 (当前时间-60天 至 当前时间)</span><br/>
                        {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.MEMBERS},<br/>
                        {(<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Product</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Category</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Bikes</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Internet Sales Amount</span><span style="color: #ff0000;">]</span>)}<br/>
                        <span style="color: #808080;">*</span>LASTPERIODS(<span style="color: #800000; font-weight: bold;">60</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.CurrentMember)<br/>
            )  <br/>
            <span style="color: #808080;">+</span>  <span style="color: #008080;">--</span><span style="color: #008080;"> UNION 去掉重复的用户集合</span><br/>
            NONEMPTY (<br/>
                        <span style="color: #008080;">--</span><span style="color: #008080;"> 取购买过 Clothing 的用户 (当前时间-60天 至 当前时间)</span><br/>
                        {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.MEMBERS},<br/>
                        {(<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Product</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Category</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Clothing</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Internet Sales Amount</span><span style="color: #ff0000;">]</span>)}<br/>
                        <span style="color: #808080;">*</span>LASTPERIODS(<span style="color: #800000; font-weight: bold;">60</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.CurrentMember)<br/>
            )  <br/>
         ) <br/>
<span style="color: #008080;">--</span><span style="color: #008080;"> 前60天的时间名称</span><br/>
MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Pre60DateName</span><span style="color: #ff0000;">]</span> <span style="color: #0000ff;">AS</span> <br/>
    LASTPERIODS(<span style="color: #800000; font-weight: bold;">60</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.CurrentMember).Item(<span style="color: #800000; font-weight: bold;">0</span>).Name    <br/>
<span style="color: #0000ff;">SELECT</span> {<br/>
            <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CustomerCounts</span><span style="color: #ff0000;">]</span>,<br/>
            <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Pre60DateName</span><span style="color: #ff0000;">]</span><br/>
       } <span style="color: #0000ff;">ON</span> COLUMNS,<br/>
       <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.MEMBERS <span style="color: #0000ff;">ON</span> ROWS<br/>
<span style="color: #0000ff;">FROM</span> <br/>
(<br/>
    <span style="color: #008080;">--</span><span style="color: #008080;"> 测试时间范围</span><br/>
    <span style="color: #0000ff;">SELECT</span> (<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">20040301</span><span style="color: #ff0000;">]</span>:<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">20040304</span><span style="color: #ff0000;">]</span>) <span style="color: #0000ff;">ON</span> COLUMNS<br/>
    <span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Step-by-Step</span><span style="color: #ff0000;">]</span> <br/>
)</span></code></pre><p>4.计算每个月第一天到前60天购买了 Bikes 或者 Clothing 产品的用户数量</p><pre><code><span style="font-family: 'Microsoft Yahei';"><span style="color: #0000ff;">WITH</span> <br/>
MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CustomerCounts</span><span style="color: #ff0000;">]</span> <span style="color: #0000ff;">AS</span><br/>
    <span style="color: #008080;">--</span><span style="color: #008080;"> 计算用户总数</span><br/>
    <span style="color: #ff00ff;">COUNT</span>(<br/>
            NONEMPTY (<br/>
                        <span style="color: #008080;">--</span><span style="color: #008080;"> 取购买过 Bikes 的用户 (当前时间-60天 至 当前时间)</span><br/>
                        {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.MEMBERS},<br/>
                        {(<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Product</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Category</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Bikes</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Internet Sales Amount</span><span style="color: #ff0000;">]</span>)}<br/>
                        <span style="color: #808080;">*</span>LASTPERIODS(<span style="color: #800000; font-weight: bold;">60</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.CurrentMember.FIRSTCHILD)<br/>
            )  <br/>
            <span style="color: #808080;">+</span>  <span style="color: #008080;">--</span><span style="color: #008080;"> UNION 去掉重复的用户集合</span><br/>
            NONEMPTY (<br/>
                        <span style="color: #008080;">--</span><span style="color: #008080;"> 取购买过 Clothing 的用户 (当前时间-60天 至 当前时间)</span><br/>
                        {<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Customer</span><span style="color: #ff0000;">]</span>.MEMBERS},<br/>
                        {(<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Product</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Category</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Clothing</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Internet Sales Amount</span><span style="color: #ff0000;">]</span>)}<br/>
                        <span style="color: #808080;">*</span>LASTPERIODS(<span style="color: #800000; font-weight: bold;">60</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.CurrentMember.FIRSTCHILD)<br/>
            )  <br/>
         ) <br/>
<span style="color: #008080;">--</span><span style="color: #008080;"> 前60天的时间名称</span><br/>
MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Pre60DateName</span><span style="color: #ff0000;">]</span> <span style="color: #0000ff;">AS</span> <br/>
    LASTPERIODS(<span style="color: #800000; font-weight: bold;">60</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.CurrentMember.FIRSTCHILD).Item(<span style="color: #800000; font-weight: bold;">0</span>).Name    <br/>
<span style="color: #0000ff;">SELECT</span> {<br/>
            <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CustomerCounts</span><span style="color: #ff0000;">]</span>,<br/>
            <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Pre60DateName</span><span style="color: #ff0000;">]</span><br/>
       } <span style="color: #0000ff;">ON</span> COLUMNS,<br/>
       <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Month</span><span style="color: #ff0000;">]</span>.MEMBERS <span style="color: #0000ff;">ON</span> ROWS<br/>
<span style="color: #0000ff;">FROM</span> <br/>
(<br/>
    <span style="color: #008080;">--</span><span style="color: #008080;"> 测试时间范围</span><br/>
    <span style="color: #0000ff;">SELECT</span> (<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">20040101</span><span style="color: #ff0000;">]</span>:<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">20040401</span><span style="color: #ff0000;">]</span>) <span style="color: #0000ff;">ON</span> COLUMNS<br/>
    <span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Step-by-Step</span><span style="color: #ff0000;">]</span> <br/>
)</span></code></pre>
</div>]
</body>
</html>
