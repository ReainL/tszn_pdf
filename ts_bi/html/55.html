
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h3 id="articleHeader1" style="margin-left: 0px;">开篇介绍</h3><p>在 ETL 项目中处理 XML 大概有这么几种常见情况：</p><ol><li>上游程序或者第三方返回程序传递给 BI 程序就是 XML 格式的文件，通常情况下这种文件格式双方约定好了就不会更改，那么我们需要在加载 XML 文件的数据之前验证一下这个 XML 格式的数据文件是否符合我们之前的定义。如果满足验证，我们就处理，不满足那么我们就不处理或者以错误输入为由记入到错误日志中。</li><li>上游的 XML 文件作为输入，我们在 BI 中不处理其中的数据，而是将此 XML 文件按照一定的格式转换成另外的一个 XML 文件输出，这样下游程序将能够容易的处理 BI ETL 的输出。</li><li>上游的 XML 文件输出了很多很多内容，但是我们可能只需要很少的一部分数据导入的数据库，并且在导入之前备份这一小部分数据，相当于从源 XML 文件中剥离出一部分数据单独备份。</li></ol><p>实际上 XML Task 包含了很多功能，比如有对比 XML 文件异同，找差异；在 XML 中查询数据；合并 XML 文件等等。</p><p>先来大致解释一下下面这几个配置选项，Operation Type - XML Task 操作的方式：</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272049180603972.png"/></p><ol><li>Diff - 用来比较两个 XML 文档，使用源 XML 文档作为基础文档，然后和第二个文档进行比较并检查出他们之间的异同，并记录不同的地方到一个文档中。</li><li>Merge - 合并两个 XML 文档，使用源 XML 文档作为基础文档，将第二个文档合并到第一个基础文档中，并且能够指定 Merge 的地方。</li><li>Patch - </li><li>Validate  - 通过 DTD (Document Type Definition) 和 XSD (XML Schema definition) 来验证和检查文档。</li><li>XPath - 执行 XPath 查询和计算。</li><li>XSLT - 执行 XML 文档的转换。</li></ol><p style="margin-left: auto;">在 XML Task 中，像 Diff, Merge 和 Patch 都是需要两个参与者的，第一个参与者就是源 XML 文档，第二个参与者也是 XML 文档，但是它自身的内容将会取决于第一个参与者指定的参与类型。比如说， Diff 操作是用来对比两个文档的，因此第二个 XML 文档就是另外的一个。</p><p style="margin-left: auto;">XML Task 中可以使用变量或者文件连接管理器作为它的源，当然这个源中是包含了 XML 的数据在其中的。当然作为输出来说，输出的内容也是可以保存为变量或者保存为文件的。</p><p>那么我们今天先来介绍一下在 XML Task 中比较常用的三大功能 - Validation 文件验证，XSLT 样式表转换，XPATH 表达式查询！</p><h3 id="articleHeader2" style="margin-left: 0px;">使用 DTD (文档类型定义) 或 XSD(XML 架构定义) 验证 XML 文档</h3><p>新建一个包，并拖放一个 XMLTask - XML_VALIDATION</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272051220606321.png"/></p><p>简单来说，你的 Operation Type 选择的不同，那么下面的配置选项就会变得不同，这里我们选择的是 Validate。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272052174045362.png"/></p><p>来解释一下下面这些配置的作用 -</p><ol><li>Input <ol><li>Operation - Validate 验证文档</li><li>SourceType - File Connection (Direct Input, Variable) 指向要验证的 XML 文件，需要创建链接管理器。Direct Input 是直接在 Source 出放入 XML 文件的内容，而 Variable 则是需要保存 XML 文件中的内容。</li><li>Source - 文件连接管理名称</li></ol></li><li>Output - SaveOperationResult 是否保存操作结果</li><li>OperationResult<ol><li>DestinationType - Variable (File Connection) 执行的结果要么就是成功 True，要们就是失败 False。结果要么写入变量中，要么就写入到指定的结果文件中，写入的内容就是 True/False。</li><li>Destination - 将由 DestinationType 决定是选择变量还是文件。</li><li>OvewriteDestination - 是否重写覆盖掉已存在的内容或者文件。</li></ol></li><li>Second Operand<ol><li>SecondOperandType - File Connection (Direct Input, Variable) 指向要 XSD 或者 DTD 文件，需要创建链接管理器。</li><li>SecondOperand - XSD 或者 DTD 文件。</li></ol></li><li>Validation Options </li><ol><li>ValidationType - XSD 或者 DTD</li><li>FailOnValidationFail - 验证失败的时候是让这个 Task 也失败还是继续往下执行。</li></ol></ol><p>这里的三个文件链接管理器和定义的变量如下所示 - </p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272053456706529.png"/></p><p>SALES_ORDER.xsd 文件内容是根据 SALES_ORDER_1.xml 文件来的，它是正确的 XSD 格式。</p><pre><code><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;?</span><span style="color: rgb(255, 0, 255); line-height: 1.5 !important;">xml version="1.0"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">?&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:schema </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">attributeFormDefault</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="unqualified"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> elementFormDefault</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="qualified"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> xmlns:xs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="http://www.w3.org/2001/XMLSchema"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="SalesOrder"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:complexType</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:sequence</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> maxOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="unbounded"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="SalesOrderDetail"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:complexType</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:sequence</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="SalesOrderID"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:unsignedInt"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="SalesOrderDetailID"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:unsignedInt"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="OrderQty"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:unsignedByte"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="ProductID"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:unsignedShort"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="UnitPrice"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:decimal"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="UnitPriceDiscount"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:decimal"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="LineTotal"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:decimal"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="rowguid"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:string"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="ModifiedDate"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:dateTime"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:sequence</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:complexType</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:sequence</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:complexType</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:schema</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span></code></pre><p style="margin-left: auto;">用这个 XSD 文档验证 SALES_ORDER_1.xml 的内容肯定是可以通过验证的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272054376231468.png"/></p><p>但是 SALES_ORDER_2.xml 的格式很明显不符合 XSD 文档的中对 SALES ORDER XML 文件的定义。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272054497643576.png"/></p><p>至少少了两列内容，并且列顺序还不完全相同</p><pre><code><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="rowguid"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:string"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xs:element </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">minOccurs</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="ModifiedDate"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> type</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xs:dateTime"</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> </code></pre><p style="margin-left: auto;">因此对于 SalesOrder1.xml 验证是可以通过的，但是对于 SalesOrder2.xml 验证是失败的，我们把验证的结果保存到了 PV_VALIDATION_RESULT 变量中。</p><p>再添加一个 Script Task 用来展示一下 PV_VALIDATION_RESULT 的结果。</p><pre><code><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">public</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">void</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;"> Main()<br/>
  {<br/>
   </span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;">//</span><span style="color: rgb(0, 128, 0); line-height: 1.5 !important;"> TODO: Add your code here</span><br/>
            MessageBox.Show(Dts.Variables[<span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">User::PV_VALIDATION_RESULT</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">"</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">].Value.ToString());<br/>
   Dts.TaskResult </span>= (<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">int</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">)ScriptResults.Success;<br/>
  }</span></code></pre><p style="margin-left: auto;">保存并执行，当 Input 的 Source 为 Sales_Order_1.xml 时，是可以通过验证的，这就意味着后面的程序可以去处理这个 XML 文件了。</p><p style="margin-left: auto;"><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272055582798140.png"/></p><p>当 Input 的 Source 改为 Sales_Order_2.xml 时，验证是不能通过的，这样后面的程序就不用处理这个 XML 文件，并且可以加写 Log 记录等。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272056133576980.png"/></p><h3 id="articleHeader3" style="margin-left: 0px;">使用 XML 样式表对 XML 文件进行格式转换</h3><p>首先了解一下需求，就拿上面的 XML 文件 SALES_ORDER_1.xml 的内容来说，我们可以看一下它的 XML 结构与格式。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272057290458737.png"/></p><p>现在需求变了，我们需要对这种格式进行转换，转换成如下结构 -</p><pre><code><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;?</span><span style="color: rgb(255, 0, 255); line-height: 1.5 !important;">xml version="1.0" encoding="utf-8"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">?&gt;</span><br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrder</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">DetailID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="110562"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>71774<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">UnitPrice</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="356.8980"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> UnitPriceDiscount</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0.0000"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>836<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>356.898000<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">DetailID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="110563"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>71774<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">UnitPrice</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="356.8980"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> UnitPriceDiscount</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0.0000"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>822<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">DetailID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="110567"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>71776<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">UnitPrice</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="63.9000"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> UnitPriceDiscount</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0.0000"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>907<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>63.900000<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span></code></pre><p style="margin-left: auto;">可以看得出来这个结构变复杂了 (通常情况下，我们对 XML 文件格式进行转换一般都是从复杂转换成简单的，但是这里是为了顺延案例流程的需求，由简单到复杂变化了)。</p><p>那么这种转换还是用的非常多的，在这里需要使用到 XSL (Extensible Stylesheet Language 扩展样式表语言，简称 XML 样式表) 和 XSLT 就是样式表转换 Transformation，关于 XSLT 内容，请查看 XSLT 教程。</p><p>为了实现这中转换，先需要设计好 XSLT 样式表转换文件 SALES_ORDER_TRANSFORMATION.xlst - </p><p>注意到 TSSalesOrder 和 TSSalesOrderDetail 的变化 (PS: TS 表示我们的<a href="http://www.flybi.net/" target="_blank">天善</a> &gt;_&gt;)</p><pre><code><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:stylesheet </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">version</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="1.0"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> xmlns:xsl</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="http://www.w3.org/1999/XSL/Transform"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:output </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">method</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="xml"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> indent</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="yes"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:template </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">match</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="/"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrder</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:for-each </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">select</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="SalesOrder/SalesOrderDetail"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:attribute </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="DetailID"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:value-of </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">select</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="SalesOrderDetailID"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:attribute</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:value-of </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">select</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="SalesOrderID"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:attribute </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="UnitPrice"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:value-of </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">select</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="UnitPrice"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:attribute</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:attribute </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">name</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="UnitPriceDiscount"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:value-of </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">select</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="UnitPriceDiscount"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:attribute</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:value-of </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">select</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="ProductID"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:value-of </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">select</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="LineTotal"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">/&gt;&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:for-each</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrder</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:template</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span> <br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">xsl:stylesheet</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span></code></pre><p style="margin-left: auto;">新建一个 XML Task，并按照如下图所示完成 OperationType = XSLT 的配置</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272102103896689.png"/></p><p>保存并执行包，包运行的结果将会把 SALES_ORDER_1.xml 文件按照 SALES_ORDER_TRANSFORMATION.xlst 样式转换表转换之后输出到 TRANSFORMATION.xml 文件中。</p><pre><code><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;?</span><span style="color: rgb(255, 0, 255); line-height: 1.5 !important;">xml version="1.0" encoding="utf-8"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">?&gt;</span><br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrder</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">DetailID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="110562"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>71774<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">UnitPrice</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="356.8980"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> UnitPriceDiscount</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0.0000"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>836<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>356.898000<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">DetailID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="110563"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>71774<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">UnitPrice</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="356.8980"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> UnitPriceDiscount</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0.0000"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>822<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">DetailID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="110567"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>71776<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">UnitPrice</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="63.9000"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> UnitPriceDiscount</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0.0000"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>907<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>63.900000<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">DetailID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="110616"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>71780<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">UnitPrice</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="218.4540"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> UnitPriceDiscount</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0.0000"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>905<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>873.816000<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">DetailID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="110617"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>71780<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">OrderID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID </span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">UnitPrice</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="461.6940"</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;"> UnitPriceDiscount</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">="0.0000"</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>983<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">ProductID</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
    <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span>923.388000<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">LineTotal</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span><br/>
  <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&lt;/</span><span style="color: rgb(128, 0, 0); line-height: 1.5 !important;">TSSalesOrderDetail</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">&gt;</span></code></pre><h3 id="articleHeader4" style="margin-left: 0px;">使用 XPATH 抽取数据 </h3><p>XPATH 是一种表达式语言，可以通过 XPATH 查找 XML 文件中的内容，比如返回某一个节点，符合条件的节点集合，值等等。</p><p>那么比如说，就 SALES_ORDER_1.xml 中我需要查找所有 Line Total &gt; 1000 的元素集合，按照 XPATH 语法查询可以这样来写：</p><pre><code>SalesOrder/SalesOrderDetail[LineTotal &gt; <span style="color: rgb(128, 0, 128); line-height: 1.5 !important;">1000</span>]</code></pre><p style="margin-left: auto;"><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272102456856273.png"/></p><ol><li>Input 仍然是 SALES_ORDER_1.xml 文件</li><li>Output 输出是 XPATH_OUTPUT.xml 文件</li><li>SecondOperand 是 XPATH 的表达式</li><li>PutResultInOneNode 一般选中 True，否则查询出去的内容就是一个 Segment 而非一个 XML 格式的内容。</li><li>XPathOperation 通常选 Node list ，查询出去的内容还是一个节点的集合形式。另外有两种，一种是 Evaluation，一种是 Value。</li></ol><p>先展示 Node List 的结果，自动的在 XML 文件前面加了一个 ResultRootNode 节点，所有 LineTotal 都大于 1000。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272103300927906.png"/></p><p>如果选 Values，则这里的 PutResultInOneNode 应该选为 False。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272103399204342.png"/></p><p>所有的节点上的 Value 值单独抽取出来显示在文件中，这种方式用的很少很少，一般单独抽取某一列转换成文本文件的时候可以考虑使用这种方式。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272103518895165.png"/></p><p>Evaluation 就没有什么作用了，就是返回一个XPath 函数的名称。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272104024354987.png"/></p><p>以下是文件中的内容-</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201409/272104131399323.png"/></p><p>所以对于 XPATH 在 XML Task 中的使用，其实就取决于 XPATH 的语法有多熟练，越熟练那么利用 XML Task 解决的有关 XML 的问题就会越多。</p><h3 id="articleHeader5" style="margin-left: 0px;">更多有关 XML 相关的文章与资源</h3><ol><li><a href="http://www.w3school.com.cn/xpath/" target="_blank">XPath 教程</a></li><li><a href="http://www.w3school.com.cn/xsl/index.asp" target="_blank">XSLT 教程</a></li><li><a href="http://www.w3school.com.cn/dtd/index.asp" target="_blank">DTD 教程</a></li><li><a href="http://www.cnblogs.com/biwork/p/3996560.html" target="_blank">微软BI 之SSIS 系列 - XML Task 中XSLT 样式表转换错误记录</a></li></ol>
<ul class="aw-upload-file-list">
</ul>
</div>]
</body>
</html>
