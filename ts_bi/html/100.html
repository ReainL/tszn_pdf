
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h2 id="articleHeader1">开篇介绍</h2><p>前些天自己在整理 SSIS 2012 资料的时候发现了一个功能设计上的疑似Bug，在 Script Task 中是可以给只读列表中的变量赋值。我记得以前在 2008 的版本中为了弄明白这个配置，还特意测试过这个细节，获取错误并理解了这个功能。但是现在回去再次测试 2008 的版本时，发现这个功能在 2008 中其实也是错误的，把我印象中的测试结果完全给推翻了，所以到现在已经搞不清楚我当时到底是如果得出这个错误的。</p><h2 id="articleHeader2">疑似功能 Bug 描述</h2><p>在 SSIS 包中定义了用户自定义变量 - PV_CURRENT_DATE，并且把它们放置在 ReadOnlyVariables 中，按照我们的通常理解那么这些变量在 Script Task 中应该就是只读性质的，不能赋值给他们。如果需要读写一个变量，那么这个变量就应该放到 ReadWriteVariables 中。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141227220135843.png"/></p><p>在代码中可以看到 PV_CURRENT_DATE 这个变量被赋值了。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141228557015997.png"/></p><p>按道理应该报错的，包执行失败的，结果却是执行成功！</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141229030293003.png"/></p><p>那么在 SSIS 2012 中要如何解决或者描述这个问题呢？ 测试一下，修改变量 PV_CURRENT_DATE 将它的 ReadOnly 属性修改为 True，标明是只读，这个时候才会出错。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141229097945436.png"/></p><p>通过断点调试就会发现这个错误的原因就是 : Error trying to write to a read-only variables，试图向只读的变量写值。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141229165442099.png"/></p><p>唯一能解释的通的就是在 SSIS 2012 中的 ReadOnlyVariables 列表中出现的就只能是 ReadOnly = True 的变量，在 ReadWriteVariables 是可以看到 ReadOnly = False 或者 ReadOnly = True 的所有变量。如果本意是这样的话，我觉得这种设计显得非常的别扭，并且 ReadOnlyVariables 这个很容易给人误导，让人认为是放入其中的变量在 Script Task 中就是只读的！</p><h2 id="articleHeader3">MSDN 论坛</h2><p>我把这个问题也贴在了 MSDN 论坛 - <a href="https://social.msdn.microsoft.com/Forums/sqlserver/en-US/62777694-f6b3-465d-8367-ef8169c0340f/is-it-a-bug-ssis-2012-readonlyvariables-in-script-task-doesnt-work?forum=sqlintegrationservices"><u><font color="#0066cc">Is it a bug - SSIS 2012 ReadOnlyVariables in Script Task doesn't work</font></u></a></p><p>回复帖子的两个 <strong>MVP </strong><a href="https://social.msdn.microsoft.com/profile/ssisjoost/" target="_blank"><u><font color="#0066cc">SSISJoost</font></u></a> 和 <a href="https://social.msdn.microsoft.com/profile/visakh16/?ws=usercard-mini" target="_blank"><u><font color="#0066cc">Visakh16</font></u></a> 也都重现了这个问题，也认为这是一个设计上的 Bug。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141230107325154.png"/></p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141230160448342.png"/></p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141230272633238.png"/></p><p>但是我最后还是自己否定了自己，只能说是疑似 Bug，但是从这个角度来考虑，也确实可能就是 By Design，以下是我的个人观点： </p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141230393737103.png"/><img alt="" src=""/></p><p>关于这个问题，我也提给了微软，可以访问  <a href="https://connect.microsoft.com/SQLServer/feedback/details/991697"><u><font color="#0066cc">SSIS 2012 ReadOnlyVariables in Script Task doesn't work </font></u></a> 来关注微软技术团队最终的确认。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141230484985924.png"/></p><p>对于这个问题，包括上面两个非常 NB 的 <strong>MVP</strong> 以及被我挖出来的这个帖子 <a href="https://social.msdn.microsoft.com/Forums/sqlserver/en-US/80e1abf8-c167-4809-8d12-0a5c6655a19f/ssis-script-task-readonlyvariables?forum=sqlintegrationservices"><u><font color="#0066cc">SSIS Script task 'ReadOnlyVariables'</font></u></a>  中的另外两个牛人 <strong>MVP </strong><a href="https://social.msdn.microsoft.com/profile/arthurz/?ws=usercard-mini" target="_blank"><u><font color="#0066cc">ArthurZ</font></u></a> 和 <a href="https://social.msdn.microsoft.com/profile/reza%20raad/?ws=usercard-mini" target="_blank"><u><font color="#0066cc">Reza Raad</font></u></a> 也同样对这一个特性持有疑似 Bug 的观点。</p><p><span style="color: rgb(0, 0, 0);"><strong>如果这么多人也都这么认为的话，即使不是 Bug，这个设计也是存在问题和缺陷的，因为着着实实误导了很多人。</strong></span></p><h2 id="articleHeader4">PS</h2><p><strong>MVP</strong> Reza Raad 的代表作 《Microsoft SQL Server 2012 Integration Services: An Expert Cookbook》</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201410/141231476383826.jpg"/></p><h3 id="articleHeader5">其它有关 Script Task 脚本任务的文章</h3><p><a href="http://www.flybi.net/blog/biwork/577" target="_blank"><u><font color="#0066cc">微软BI 之SSIS 系列 - 使用 Script Task 访问非 Windows 验证下的 SMTP 服务器发送邮件</font></u></a> </p><h3 id="articleHeader6">MSDN 论坛的 BI MVP 们</h3><ul><li><a href="https://social.msdn.microsoft.com/profile/arthurz/?ws=usercard-mini" target="_blank"><u><font color="#0066cc">ArthurZ</font></u></a> (MVP,MCDBA, MCAD, MCTS and MCITP)</li><li><a href="https://social.msdn.microsoft.com/profile/reza%20raad/?ws=usercard-mini" target="_blank"><u><font color="#0066cc">Reza Raad</font></u></a> (MVP, MCP, MCTS and MCI《Microsoft SQL Server 2012 Integration Services: An Expert Cookbook》作者)</li><li><a href="https://social.msdn.microsoft.com/profile/ssisjoost/" target="_blank"><u><font color="#0066cc">SSISJoost</font></u></a> (MVP, SSIS)</li><li><a href="https://social.msdn.microsoft.com/profile/visakh16/?ws=usercard-mini" target="_blank"><u><font color="#0066cc">Visakh16</font></u></a> (MVP, SSIS,SSAS,SSRS)</li></ul><h2 id="articleHeader7">微软已经确认这是一个 Bug</h2><p>更新自 2014年12月15日，看到微软已经确定了这是一个 Bug，并且从 2008 R2 版本中就存在这个 Bug 的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201412/151535509061142.png"/></p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201412/151535574532977.png"/><br/></p>
</div>]
</body>
</html>
