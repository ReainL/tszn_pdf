
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h3 id="articleHeader1" style="margin-left: 0px;">开篇介绍</h3><p>在前两篇中讲解到了 Merge 和 Merge Join 的操作，今天这篇文章讲解的是关于 Union All 的操作。</p><h3 id="articleHeader2" style="margin-left: 0px;">Union All </h3><p>首先在什么时候需要使用到 Union All？</p><p>与 Merge 和 Merge Join 不同，使用 Union All 的最显著的特点就是：</p><ul><li>两个或者两个以上的输入源。</li><li>不需要排序，输出结果也不需要排序。</li></ul><p> </p><p>测试数据</p><pre><code><span style="color: rgb(0, 128, 128); line-height: 1.5 !important;">--</span><span style="color: rgb(0, 128, 128); line-height: 1.5 !important;"> Merge demo table</span><br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">IF</span> <span style="color: rgb(255, 0, 255); line-height: 1.5 !important;">OBJECT_ID</span>(<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">T038_CUSTOMER</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">U</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>) <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">IS</span> <span style="color: rgb(128, 128, 128); line-height: 1.5 !important;">NOT</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">NULL</span><br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">DROP</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">TABLE</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;"> T038_CUSTOMER<br/>
</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">GO</span><br/>
<br/>
<span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">CREATE</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">TABLE</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;"> T038_CUSTOMER<br/>
(<br/>
  CustomerID </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">INT</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">PRIMARY</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">KEY</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">,<br/>
  CustomerCompany </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold; line-height: 1.5 !important;">255</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">),<br/>
  CustomerName </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold; line-height: 1.5 !important;">20</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">),<br/>
  CustomerAddress </span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold; line-height: 1.5 !important;">255</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">)<br/>
)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">INSERT</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">INTO</span> T038_CUSTOMER <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">VALUES</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;"><br/>
(</span><span style="color: rgb(128, 0, 0); font-weight: bold; line-height: 1.5 !important;">1</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">HFBZG</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">Allen,Michael</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">Obere Str. 0123</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">),<br/>
(</span><span style="color: rgb(128, 0, 0); font-weight: bold; line-height: 1.5 !important;">2</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">MLTDN</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">Hassall, Mark</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">Avda. de la Constitución 5678</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">),<br/>
(</span><span style="color: rgb(128, 0, 0); font-weight: bold; line-height: 1.5 !important;">3</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">KBUDE</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">Peoples, John</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">Mataderos 1000</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">),<br/>
(</span><span style="color: rgb(128, 0, 0); font-weight: bold; line-height: 1.5 !important;">6</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">HFBZG</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">Allen,Michael</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span>,<span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">Obere Str. 0123</span><span style="color: rgb(255, 0, 0); line-height: 1.5 !important;">\'</span><span style="color: rgb(0, 0, 0); line-height: 1.5 !important;">) <br/>
<br/>
</span><span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">SELECT</span> <span style="color: rgb(128, 128, 128); line-height: 1.5 !important;">*</span> <span style="color: rgb(0, 0, 255); line-height: 1.5 !important;">FROM</span> T038_CUSTOMER</code></pre><p style="margin-left: auto;"><img alt="" src="http://images.cnitblog.com/blog/477275/201411/121055240859862.png"/></p><p>源文件 1的 ID 5 两条数据是相同的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201411/121055319443197.png"/></p><p>源文件 2 的第 1 条和源文件 1 的第 1 条是完全一样的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201411/121055384137073.png"/></p><p>下面要合并的是这三个数据源的数据，因此需要使用到 UNION ALL。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201411/121055468358279.png"/></p><p>合并数据的时候也要求合并列的数据类型要一致，否则就会出现下列错误。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201411/121055551004970.png"/></p><p>执行包可以看到各自合并之前的条数。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201411/121056042723507.png"/></p><p>可以看到所有的数据都合并在一起往下输出了，保留了重复记录的同时，输出结果也未排序。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201411/121056128357755.png"/></p><h3 id="articleHeader3" style="margin-left: 0px;">总结 Union All 的使用特点</h3><ul><li>数据源可以由 2 个或者 2个以上的输入源组成。</li><li>数据源可以是表，也可以是文件。</li><li>合并列的数据类型要求相同。</li><li>合并前不需要排序操作。</li><li>合并后的输出也非已排序输出。</li><li>保留重复数据，类似于 SQL Server 中的 Union All。</li></ul><h3 id="articleHeader4" style="margin-left: 0px;">Merge，Merge Join 和 Union All 的异同</h3><p><img alt="" src="http://images.cnitblog.com/blog/477275/201411/121056247882808.png"/></p>
</div>]
</body>
</html>
