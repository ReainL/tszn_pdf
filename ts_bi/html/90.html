
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h2 id="articleHeader1">开篇介绍</h2><p>对于维度成员和事实数据直接的关系看到更多的可能还是一对一，一对多的关系。比方在事实维度(或退化维度)中一个订单和明细号组合而成的ID，对应的就是事实表中的一条数据，这就是一对一的关系。比方说在产品维度中，一个产品维度成员可能对应着多个事实数据成员，这就是一对多的关系。说简单点，就是事实表的外键引用了维度表的主键，形成了这种关系。</p><p>下面的这个例子就是一种多对多的情况，通常情况下，如果维度和度量值组中间是多对多的关系，那么在它们之间就需要创建一个中间事实表。 这个中间事实表的主键在数据仓库中可以不需要设计，包括与左侧维度表和右侧事实表之间的主外键关联也不需要设计，直接在数据源视图中修改逻辑关联就可以了 (在我的脚本代码中为了方便都主动的加上了主外键关联)。</p><p>如果要在 DimSalesReason 和 FactInternetSales 建立关联的话，那么就需要通过定义多对多关系来实现。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04204955-74386f74b5204a0788c77cb42c3641e4.png"/></p><p>DimSalesReason - 销售原因维度，即每笔订单都会对应一个或者多个销售原因，比如因为价格原因和产品推广原因客户购买了，或者就是单单价格原因客户购买了。</p><p>类似于这种结构，我们一般可以这样来操作:</p><ol><li>第一步：基于 DimSalesReason 维度表创建一个常规维度 Sales Reason。</li><li>第二步：基于 FactInternetSales 事实表创建一个事实维度 InternetSalesFact。</li><li>这样一来在定义维度用法时:</li><li>第三步：SalesReason 对度量值组 Internet Sales Reason (即FactInternetSalesReason) 将形成一种一对多的关系，常规用法。</li><li>第四步：InternetSalesFact 对度量值组 Internet Sales Reason (即FactInternetSalesReason) 将形成一种一对多的关系，常规用法。</li><li>第五步：InternetSalesFact 对度量值组 Internet Sales (即FactInternetSales)将形成一种一对多的关系，事实用法。注：广义上来讲，这里的一对多关系其实也包含了一对一的关系。</li><li>第六步，最后 Sales Reason 维度将借助于 度量值组 Internet Sales Reason 关系到事实维度 InternetSalesFact，并通过事实维度 InternetSalesFact 关联到度量值组 Internet Sales而形成一种多对多的关系。</li></ol><h2 id="articleHeader2">第一步</h2><p>首先还是先将 DimSalesReason 这个维度创建好。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04205609-63bd6afb18d94393a57d74568995cdc4.png"/></p><h2 id="articleHeader3">第二步</h2><p>添加一个事实维度，选择事实表 FactInternetSales。由于事实表并不存在类似于维度的 NameColumn 描述信息，并且这个事实表也非常的特殊，因为它是由 SalesOrderNumber 和 SalesOrderLineNumber 共同组成的主键列。由于相对而言 SalesOrderNumber 比 SalesOrderLineNumber 更有意义一些，这里选择 SalesOrderNumber 作为 Name Colum。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04224220-12b8500de6f9496195fb3b7372fd3c0f.png"/></p><p>不需要与其它的维度进行关联。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04215120-04c73a36e3c94b3792028960a43d016b.png"/></p><p>不需要太多的属性，就留一个主 KEY 就可以了。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04215152-c857cd84b4ea41648781f528e5646b4d.png"/></p><p>下一步并将维度名称命名为InternetSalesFact, 把 Fact 写在最后表示它是一个事实维度。</p><p>两个维度创建好了之后，保存并部署项目，同时修改 Cube 向 Cube 添加一个度量值组 - Fact Internet Sales Reason，这个维度只是一个中间维度。</p><p>可以隐藏 Fact Internet Sales Reason Count 度量值，因为实际上没有特别大的意义，讲它的 Visible 属性设置为 False。</p><p>一会将度量值组名称改为 - Internet Sales Reason。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04205713-8e5915971d5144408c1e824c546f9942.png"/></p><p>保存并部署，然后编辑多维数据集的维度用法， 添加 SalesReason 维度后在 SalesReason 与 Internet Sales Reason 之间默认出现一个 Sales Reason。</p><h2 id="articleHeader4">第三步</h2><p>SalesReason 对度量值组 Internet Sales Reason (即FactInternetSalesReason) 将形成一种一对多的关系，常规用法。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04225101-1a0bcaefc0394ed38878286389bb2ebf.png"/></p><p>点击查看它们默认的关系，注意这里只是 SalesReason 维度和这个中间度量值组之间的关系，实际上 SalesReason 和 Internet Sales 之间是没有关联的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04210434-7d82aa79715e45ae8fe6137671b50d03.png"/></p><p>在维度用法中添加新的维度即事实维度 InternetSalesFact，将表现第四步和第五步的行为。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04225559-392386bbdba84c559304bba77044f836.png"/></p><h2 id="articleHeader5">第四步</h2><p>InternetSalesFact 对度量值组 Internet Sales Reason (即FactInternetSalesReason) 将形成一种一对多的关系，常规用法。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04230048-33c6a234348b4efa92a3411d2183c50b.png"/></p><h2 id="articleHeader6">第五步</h2><p>InternetSalesFact 对度量值组 Internet Sales (即FactInternetSales)将形成一种一对多的关系，事实用法。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04230139-4bbae3419592443787315ad75c9a89ce.png"/></p><h2 id="articleHeader7">第六步</h2><p>最后 Sales Reason 维度将借助于 度量值组 Internet Sales Reason 关系到事实维度 InternetSalesFact，并通过事实维度 InternetSalesFact 关联到度量值组 Internet Sales而形成一种多对多的关系。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04230215-18e5864e4c4f45c796b8a938a57904d6.png"/></p><p>可以看到 SalesReason 和 InternetSales 之间形成了多对多关系。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/04230300-74e58c33739e4cf4a3b1dd4d5166cf3a.png"/></p><p>保存并部署，浏览一下 Cube 中的数据。可以看到订单号为 SO43697 的这笔订单有两个销售原因 - Manufacturer 和 Quality，虽然两个销售原因对应的销售额都是 3578美元，但是这仍然是属于一笔订单，因此看到销售类别 Other 的 Internet Sales Amount 还是显示的是 3578 美元。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/05204055-c2d349de74b44b59b99bff2b671634a8.png"/></p><p>数据库中的订单对应了两个销售原因，但它的销售额仍然是 3578.27 而不是 两个 SalesAmount的总和。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201401/05204039-90b6cfe590d949e7afc4505d9357dc17.png"/></p><h2 id="articleHeader8">参看与本文相关的文章如下</h2><p><a href="http://www.flybi.net/blog/biwork/1075"><u><font color="#0066cc">SSAS 系列 - 多维数据集维度用法之一 引用维度 Referenced Dimension</font></u></a></p><p><a href="http://www.flybi.net/blog/biwork/1081"><u><font color="#0066cc">SSAS 系列 - 多维数据集维度用法之二 事实维度(退化维度 Degenerate Dimension)</font></u></a></p><h2 id="articleHeader9">引起争论的结论</h2><p>虽然这篇文章讲到了多对多维度的实现，但是实际开发中尽量避免使用这种关联关系，因为多对多的关系处理在数据聚合上效率肯定比通常一对一，一对多的效率要低很多。同时由于在建立多对多关系的时候需要额外创建一个事实维度来实现这种多对多的关联，因此额外的事实维度需要被创建，在维度处理上变得更复杂，个人建议在设计的时候应该尽量避免这种关系的出现。<br/></p>
</div>]
</body>
</html>
