
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h2 id="articleHeader1">开篇介绍</h2><p>之前我写了一篇在 SSRS 开发中处理这种父子关系的汇总与聚合的文章 (<a href="http://www.flybi.net/blog/biwork/1025"><u><font color="#0066cc">SSRS 系列 - 使用分组 Group 属性实现基于父子递归关系的汇总报表</font></u></a>)，示例中的查询是基于 SQL Server 关系型数据库的，这一篇是基于 MDX 父子维度的 SSRS 报表。</p><p>沿用上一篇中的 (<a href="http://www.flybi.net/blog/biwork/572"><u><font color="#0066cc">SSAS系列 - 关于父子维度的设计</font></u></a>）父子维度 和(<a href="http://www.flybi.net/blog/biwork/572"><u><font color="#0066cc">SSAS 系列 - 自定义的日期维度设计</font></u></a>) 的时间维度，并在此基础上创建 Cube 并部署。</p><h2 id="articleHeader2">案例设计</h2><p>当然在这个例子中可能不会使用到时间维度，之所以添加进来只是因为在 Cube 的创建过程中 SSDT 开发工具会提示：不要创建只含有一个维度的多维数据集。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173051-f0189e781a5d460295ac4b5e283cc878.png"/></p><p>部署完成之后，我们可以通过 MDX 查看一下相应的维度和度量值数据。</p><pre><code><span style="font-family: Microsoft Yahei; font-size: 14px;"><span style="color: rgb(0, 0, 255);">SELECT</span> (<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Sales Amount</span><span style="color: rgb(255, 0, 0);">]</span>) <span style="color: rgb(0, 0, 255);">ON</span> COLUMNS,<br/>
       NON EMPTY(<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Employee</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Employees</span><span style="color: rgb(255, 0, 0);">]</span>.Members) <span style="color: rgb(0, 0, 255);">ON</span> ROWS<br/>
<span style="color: rgb(0, 0, 255);">FROM</span> <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">BIWORK_ParentChildDemo</span><span style="color: rgb(255, 0, 0);">]</span></span></code></pre><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173123-95b6e549838c4372b917d71b4c35d58e.png"/></p><p>但是像这样显然不够，因为我们不仅仅需要知道我们应该查询的不光是当前成员，而且应该展现当前成员的后代子成员。</p><p>并且通过 Dimension 属性来定义要获取到这些成员的 MEMBER_CAPTION (在父子维度设计的那篇文章已经提到了), 成员的唯一名称 MEMBER_UNIQUE_NAME，父成员的唯一名称 PARENT_UNIQUE_NAME， 层次结构中的级别 LEVEL_NUMBER。</p><pre><code><span style="font-family: Microsoft Yahei; font-size: 14px;"><span style="color: rgb(0, 0, 255);">SELECT</span> NON EMPTY { <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Sales Amount</span><span style="color: rgb(255, 0, 0);">]</span>} <span style="color: rgb(0, 0, 255);">ON</span> COLUMNS,<br/>
       NON EMPTY { <br/>
                    (<br/>
                        DESCENDANTS(<br/>
                                     <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Employee</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Employees</span><span style="color: rgb(255, 0, 0);">]</span>.ALLMEMBERS<br/>
                                   ) <br/>
                    ) <br/>
                 } <br/>
DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME, PARENT_UNIQUE_NAME, <br/>
LEVEL_NUMBER <span style="color: rgb(0, 0, 255);">ON</span> ROWS <br/>
<span style="color: rgb(0, 0, 255);">FROM</span> <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">BIWORK_ParentChildDemo</span><span style="color: rgb(255, 0, 0);">]</span></span></code></pre><p>每一个成员的后代子成员都会被查询出来，这里只展现部分数据。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23174550-f8a5c5af1fe6401c9e6a0fe771cfb9b7.png"/></p><p>如何创建报表和连接 SSAS 分析服务数据库，以及如何创建基于 SSAS MDX 查询的 Dataset 在这里就不再说了，可以参考我的<a href="http://www.flybi.net/blog/biwork/1054"><u><font color="#0066cc">这篇文章</font></u></a>。</p><p>设计好报表并拖放好一个 Table 组件，指定好 Employees 和 Sales Amount 列。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173214-3b8c8245566d407c84411aa819538df0.png"/></p><p>选中 Employees 这一行，右键编辑 Group 属性。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173220-bc5b67c2089c42339aeb6dd62317a9da.png"/></p><p>在这里注意分组的属性并不是 Employees 而是它的维度属性 Employees.UniqueName 。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173226-3b316978f5bd41948f74ee39e978a83b.png"/></p><p>递归父类也是使用的维度属性 Employees.ParentUniqueName 。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173232-819b8c69b8db4cc5b785ec8276b27cf5.png"/></p><p>可以根据名字或者 Sales Amount 排序，这里选择的是 Employees 。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173238-9d1c274baaca4eeab8f77d7c5d12e44f.png"/></p><p>设置显示和隐藏是根据点击 Employees 决定的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173244-39ab9838dc444be390a51ae0b5e8d267.png"/></p><p>设置 Employees 名称的 Textbox 属性，根据级别高低来决定左边距的缩进距离。</p><p>=Cstr(Level() * 20) &amp; "pt"</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173250-d285dbee96e344019b7bd0211a1243b6.png"/></p><p>为了显示不同的级别的背景，也可以手动的设置行背景，粗略的设置了一下颜色，实际开发中可以精心设置。</p><p>=Switch(LEVEL()=0,"LightSlateGray",LEVEL()=1,"LightSteelBlue",LEVEL()=2,"LightBlue",LEVEL()=3,"LightCyan",LEVEL()=4,"Azure",LEVEL()=5,"White")</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173256-9fd294c9664f48d5851baee3b0966ec1.png"/></p><p>保存并预览报表的效果，虽然是基于 Cube 的 MDX 查询，但是实现起来也比较容易。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173301-2939dac6eba94b28a80efdf2950acb81.png"/></p><p>可以对比一下之前通过数据仓库直接查询的父子递归实现的 SSRS 报表，数据上都是正确的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/23173307-a9397cbc06ac4bc1a39022ee6eb311f5.png"/><br/><br/></p>
</div>]
</body>
</html>
