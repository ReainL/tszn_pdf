
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h2 id="articleHeader1">开篇介绍</h2><p>在熟悉完下面这三种维度的创建方式之后，就可以开始创建我们的第一个 Cube 了。</p><p><a href="http://www.cnblogs.com/biwork/p/3486240.html"><u><font color="#0066cc">SSAS 系列 - 自定义的日期维度设计</font></u></a></p><p><a href="http://www.cnblogs.com/biwork/p/3487124.html"><u><font color="#0066cc">SSAS 系列 - 基于雪花模型的维度设计</font></u></a></p><p><a href="http://www.cnblogs.com/biwork/p/3487814.html"><u><font color="#0066cc">SSAS系列 - 关于父子维度的设计</font></u></a></p><h2 id="articleHeader2">测试数据</h2><p>我们将使用下面的这些脚本来创建一些维度表和事实表，数据源的来源是 AdventureWorksDW2012，但由于数据列太多因此我精简了一些表并且自定义了 DimDate 表。</p><pre><code class="lang-sql"><span style="color: rgb(0, 0, 255);">USE</span><span style="color: rgb(0, 0, 0);"> BIWORK_SSIS<br/>
</span><span style="color: rgb(0, 0, 255);">GO</span><br/>
<span style="color: rgb(0, 0, 255);">SET</span> NOCOUNT <span style="color: rgb(0, 0, 255);">ON</span><br/>
<span style="color: rgb(0, 0, 255);">IF</span> <span style="color: rgb(255, 0, 255);">OBJECT_ID</span>(<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">FactInternetSales</span><span style="color: rgb(255, 0, 0);">'</span>,<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">U</span><span style="color: rgb(255, 0, 0);">'</span>) <span style="color: rgb(0, 0, 255);">IS</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><br/>
<span style="color: rgb(0, 0, 255);">DROP</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactInternetSales<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">IF</span> <span style="color: rgb(255, 0, 255);">OBJECT_ID</span>(<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">FactResellerSales</span><span style="color: rgb(255, 0, 0);">'</span>,<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">U</span><span style="color: rgb(255, 0, 0);">'</span>) <span style="color: rgb(0, 0, 255);">IS</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><br/>
<span style="color: rgb(0, 0, 255);">DROP</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactResellerSales<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">IF</span> <span style="color: rgb(255, 0, 255);">OBJECT_ID</span>(<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DimEmployee</span><span style="color: rgb(255, 0, 0);">'</span>,<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">U</span><span style="color: rgb(255, 0, 0);">'</span>) <span style="color: rgb(0, 0, 255);">IS</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><br/>
<span style="color: rgb(0, 0, 255);">DROP</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimEmployee<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">IF</span> <span style="color: rgb(255, 0, 255);">OBJECT_ID</span>(<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DimDate</span><span style="color: rgb(255, 0, 0);">'</span>,<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">U</span><span style="color: rgb(255, 0, 0);">'</span>) <span style="color: rgb(0, 0, 255);">IS</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><br/>
<span style="color: rgb(0, 0, 255);">DROP</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimDate <br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">IF</span> <span style="color: rgb(255, 0, 255);">OBJECT_ID</span>(<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DimProduct</span><span style="color: rgb(255, 0, 0);">'</span>,<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">U</span><span style="color: rgb(255, 0, 0);">'</span>) <span style="color: rgb(0, 0, 255);">IS</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><br/>
<span style="color: rgb(0, 0, 255);">DROP</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimProduct <br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">IF</span> <span style="color: rgb(255, 0, 255);">OBJECT_ID</span>(<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DimProductSubcategory</span><span style="color: rgb(255, 0, 0);">'</span>,<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">U</span><span style="color: rgb(255, 0, 0);">'</span>) <span style="color: rgb(0, 0, 255);">IS</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><br/>
<span style="color: rgb(0, 0, 255);">DROP</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimProductSubcategory<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">IF</span> <span style="color: rgb(255, 0, 255);">OBJECT_ID</span>(<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DimProductCategory</span><span style="color: rgb(255, 0, 0);">'</span>,<span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">U</span><span style="color: rgb(255, 0, 0);">'</span>) <span style="color: rgb(0, 0, 255);">IS</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><br/>
<span style="color: rgb(0, 0, 255);">DROP</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimProductCategory<br/>
</span><span style="color: rgb(0, 0, 255);">GO</span><br/>
<br/>
<span style="color: rgb(0, 0, 255);">CREATE</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimDate<br/>
(<br/>
    DateKey </span><span style="color: rgb(0, 0, 255);">INT</span> <span style="color: rgb(0, 0, 255);">PRIMARY</span> <span style="color: rgb(0, 0, 255);">KEY</span><span style="color: rgb(0, 0, 0);">,<br/>
    ShortDateName </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">12</span>) <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    FullDateName </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">20</span>)  <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    DayNumberOfWeek </span><span style="color: rgb(0, 0, 255);">TINYINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    DayNameOfWeek </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">10</span>) <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    DayNumberOfMonth </span><span style="color: rgb(0, 0, 255);">TINYINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    DayNumberOfYear </span><span style="color: rgb(0, 0, 255);">SMALLINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    WeekNumberOfYear </span><span style="color: rgb(0, 0, 255);">TINYINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    IsWeekend </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">7</span>) <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    IsLeapYear </span><span style="color: rgb(0, 0, 255);">BIT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    MonthKey </span><span style="color: rgb(0, 0, 255);">INT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    MonthNumberOfYear </span><span style="color: rgb(0, 0, 255);">TINYINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    MonthNameOfYear </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">10</span>) <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    MonthNameWithYear </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">20</span>) <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    CalendarQuarterKey </span><span style="color: rgb(0, 0, 255);">INT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    CalendarQuarterNumber </span><span style="color: rgb(0, 0, 255);">TINYINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    CalendarQuarterNameWithYear </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">20</span>) <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    CalendarSemesterNumber </span><span style="color: rgb(0, 0, 255);">TINYINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    CalendarYearKey </span><span style="color: rgb(0, 0, 255);">SMALLINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    CalendarYearName </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">20</span>) <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    FiscalQuarterKey </span><span style="color: rgb(0, 0, 255);">INT</span><span style="color: rgb(0, 0, 0);">,<br/>
    FiscalQuarterNumber </span><span style="color: rgb(0, 0, 255);">TINYINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    FiscalQuarterName </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">20</span><span style="color: rgb(0, 0, 0);">),<br/>
    FiscalSemester </span><span style="color: rgb(0, 0, 255);">TINYINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br/>
    FiscalYearKey </span><span style="color: rgb(0, 0, 255);">SMALLINT</span> <span style="color: rgb(128, 128, 128);">NOT</span> <span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">, <br/>
    FiscalYearName </span><span style="color: rgb(0, 0, 255);">NVARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">20</span><span style="color: rgb(0, 0, 0);">),<br/>
)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">DECLARE</span> <span style="color: rgb(0, 128, 0);">@StartDate</span> <span style="color: rgb(0, 0, 255);">DATETIME</span><br/>
<span style="color: rgb(0, 0, 255);">DECLARE</span> <span style="color: rgb(0, 128, 0);">@EndDate</span> <span style="color: rgb(0, 0, 255);">DATETIME</span><br/>
<br/>
<span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(0, 128, 0);">@StartDate</span> <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">2005-01-01</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
       </span><span style="color: rgb(0, 128, 0);">@EndDate</span> <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">2013-12-31</span><span style="color: rgb(255, 0, 0);">'</span><br/>
<br/>
<span style="color: rgb(0, 0, 255);">WHILE</span> (<span style="color: rgb(0, 128, 0);">@StartDate</span> <span style="color: rgb(128, 128, 128);">&lt;=</span> <span style="color: rgb(0, 128, 0);">@EndDate</span><span style="color: rgb(0, 0, 0);">)<br/>
</span><span style="color: rgb(0, 0, 255);">BEGIN</span><br/>
    <span style="color: rgb(0, 0, 255);">INSERT</span> <span style="color: rgb(0, 0, 255);">INTO</span><span style="color: rgb(0, 0, 0);"> DimDate <br/>
    (<br/>
        DateKey,<br/>
        ShortDateName,<br/>
        FullDateName, <br/>
        DayNumberOfWeek,<br/>
        DayNameOfWeek,<br/>
        DayNumberOfMonth,<br/>
        DayNumberOfYear, <br/>
        WeekNumberOfYear,<br/>
        IsWeekend,<br/>
        IsLeapYear, <br/>
        MonthKey,<br/>
        MonthNumberOfYear,<br/>
        MonthNameOfYear, <br/>
        MonthNameWithYear,  <br/>
        CalendarQuarterKey,<br/>
        CalendarQuarterNumber,<br/>
        CalendarQuarterNameWithYear,<br/>
        CalendarSemesterNumber,<br/>
        CalendarYearKey, <br/>
        CalendarYearName,  <br/>
        FiscalQuarterNumber, <br/>
        FiscalSemester,<br/>
        FiscalYearKey <br/>
    )<br/>
    </span><span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(255, 0, 255);">CAST</span>(<span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">VARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">8</span>),<span style="color: rgb(0, 128, 0);">@StartDate</span>,<span style="color: rgb(128, 0, 0); font-weight: bold;">112</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(0, 0, 255);">INT</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DateKey</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">VARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">20</span>), <span style="color: rgb(0, 128, 0);">@StartDate</span>,<span style="color: rgb(128, 0, 0); font-weight: bold;">106</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">ShortDateName</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">VARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">2</span>),<span style="color: rgb(255, 0, 255);">DATENAME</span>(DD,<span style="color: rgb(0, 128, 0);">@StartDate</span><span style="color: rgb(0, 0, 0);">)) <br/>
                    </span><span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(255, 0, 0);">'</span> <br/>
                    <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">DATENAME</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span><span style="color: rgb(0, 0, 0);">) <br/>
                    </span><span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(255, 0, 0);">'</span> <br/>
                    <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">CHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">4</span>), <span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span>)) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">FullDateName</span><span style="color: rgb(255, 0, 0);">'</span>, <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> 1 July 2005  </span><br/>
           <span style="color: rgb(255, 0, 255);">DATEPART</span>(DW,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DayNumberOfWeek</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">DATENAME</span>(DW,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DayNameOfWeek</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">DATENAME</span>(DD,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DayNumberOfMonth</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">DATENAME</span>(DY,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">DayNumberOfYear</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">DATEPART</span>(WW,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">WeekNumberOfYear</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">CASE</span> <span style="color: rgb(0, 0, 255);">WHEN</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(DW,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">IN</span> (<span style="color: rgb(128, 0, 0); font-weight: bold;">1</span>,<span style="color: rgb(128, 0, 0); font-weight: bold;">7</span><span style="color: rgb(0, 0, 0);">)  <br/>
                    </span><span style="color: rgb(0, 0, 255);">THEN</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">Weekend</span><span style="color: rgb(255, 0, 0);">'</span><br/>
                <span style="color: rgb(0, 0, 255);">ELSE</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">Weekday</span><span style="color: rgb(255, 0, 0);">'</span> <br/>
           <span style="color: rgb(0, 0, 255);">END</span> <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">IsWeekend</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">CASE</span> <span style="color: rgb(0, 0, 255);">WHEN</span> ((<span style="color: rgb(255, 0, 255);">YEAR</span>(<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">%</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">4</span> <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">0</span>) <span style="color: rgb(128, 128, 128);">AND</span> (<span style="color: rgb(255, 0, 255);">YEAR</span>(<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">%</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">100</span> <span style="color: rgb(128, 128, 128);">!=</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">0</span> <span style="color: rgb(128, 128, 128);">OR</span> <span style="color: rgb(255, 0, 255);">YEAR</span>(<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">%</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">400</span> <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">0</span><span style="color: rgb(0, 0, 0);">))<br/>
                    </span><span style="color: rgb(0, 0, 255);">THEN</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span><br/>
                <span style="color: rgb(0, 0, 255);">ELSE</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">0</span><br/>
           <span style="color: rgb(0, 0, 255);">END</span> <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">IsLeapYear</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">, <br/>
           </span><span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">100</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">MonthKey</span><span style="color: rgb(255, 0, 0);">'</span>, <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> 200507</span><br/>
           <span style="color: rgb(255, 0, 255);">DATEPART</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">MonthNumberOfYear</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">DATENAME</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">MonthNameOfYear</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">DATENAME</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">CHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">4</span>),<span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span>)) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">MonthNameWithYear</span><span style="color: rgb(255, 0, 0);">'</span>,  <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> July 2005  </span><br/>
           <span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">100</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(QQ,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">CalendarQuarterKey</span><span style="color: rgb(255, 0, 0);">'</span>,  <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> 200503</span><br/>
           <span style="color: rgb(255, 0, 255);">DATEPART</span>(QQ,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">CalendarQuarterNumber</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">CY </span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">CHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">4</span>),<span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span><span style="color: rgb(0, 0, 0);">)) <br/>
                 </span><span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);"> Qtr </span><span style="color: rgb(255, 0, 0);">'</span> <br/>
                 <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">CHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">1</span>), <span style="color: rgb(255, 0, 255);">DATEPART</span>(QQ,<span style="color: rgb(0, 128, 0);">@StartDate</span>)) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">CalendarQuarterNameWithYear</span><span style="color: rgb(255, 0, 0);">'</span>, <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> CY 2005 Qtr 3  </span><br/>
           <span style="color: rgb(255, 0, 255);">CASE</span> <span style="color: rgb(0, 0, 255);">WHEN</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">BETWEEN</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span> <span style="color: rgb(128, 128, 128);">AND</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">6</span><br/>
                    <span style="color: rgb(0, 0, 255);">THEN</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span><br/>
                <span style="color: rgb(0, 0, 255);">ELSE</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">2</span><br/>
           <span style="color: rgb(0, 0, 255);">END</span> <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">CalendarSemester</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">CalendarYearKey</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,  <br/>
           </span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">CY </span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">CHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">4</span>),<span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span>)) <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">CalendarYearName</span><span style="color: rgb(255, 0, 0);">'</span>, <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> CY 2005 </span><br/>
           <span style="color: rgb(255, 0, 255);">CASE</span> <span style="color: rgb(0, 0, 255);">WHEN</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">BETWEEN</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span> <span style="color: rgb(128, 128, 128);">AND</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">6</span><br/>
                     <span style="color: rgb(0, 0, 255);">THEN</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(QQ,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">2</span><br/>
                <span style="color: rgb(0, 0, 255);">ELSE</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(QQ,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">-</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">2</span><br/>
           <span style="color: rgb(0, 0, 255);">END</span> <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">FiscalQuarter</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">CASE</span> <span style="color: rgb(0, 0, 255);">WHEN</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">BETWEEN</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span> <span style="color: rgb(128, 128, 128);">AND</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">6</span><br/>
                    <span style="color: rgb(0, 0, 255);">THEN</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">2</span><br/>
                <span style="color: rgb(0, 0, 255);">ELSE</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span><br/>
           <span style="color: rgb(0, 0, 255);">END</span> <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">FiscalSemester</span><span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,<br/>
           </span><span style="color: rgb(255, 0, 255);">CASE</span> <span style="color: rgb(0, 0, 255);">WHEN</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(MM,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">BETWEEN</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span> <span style="color: rgb(128, 128, 128);">AND</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">6</span><br/>
                    <span style="color: rgb(0, 0, 255);">THEN</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span><span style="color: rgb(0, 0, 0);">) <br/>
                </span><span style="color: rgb(0, 0, 255);">ELSE</span> <span style="color: rgb(255, 0, 255);">DATEPART</span>(YY,<span style="color: rgb(0, 128, 0);">@StartDate</span>) <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span><br/>
           <span style="color: rgb(0, 0, 255);">END</span> <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">FiscalYear</span><span style="color: rgb(255, 0, 0);">'</span> <br/>
    <br/>
           <span style="color: rgb(0, 0, 255);">UPDATE</span><span style="color: rgb(0, 0, 0);"> DimDate <br/>
           </span><span style="color: rgb(0, 0, 255);">SET</span> FiscalQuarterKey <span style="color: rgb(128, 128, 128);">=</span> FiscalYearKey <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">100</span> <span style="color: rgb(128, 128, 128);">+</span> FiscalQuarterNumber,  <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> 200601</span><br/>
               FiscalYearName <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">FY </span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">CHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">4</span>), FiscalYearKey),   <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> FY 2006</span><br/>
               FiscalQuarterName <span style="color: rgb(128, 128, 128);">=</span>  <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">FY </span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">Char</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">4</span>), FiscalYearKey) <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);"> Qtr </span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">CHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">1</span>), FiscalQuarterNumber) <span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);"> FY 2006 Qtr 1      </span><br/>
           <span style="color: rgb(0, 0, 255);">WHERE</span> DateKey <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">INT</span>,<span style="color: rgb(255, 0, 255);">CONVERT</span>(<span style="color: rgb(0, 0, 255);">VARCHAR</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">8</span>),<span style="color: rgb(0, 128, 0);">@StartDate</span>,<span style="color: rgb(128, 0, 0); font-weight: bold;">112</span><span style="color: rgb(0, 0, 0);">))<br/>
        <br/>
    </span><span style="color: rgb(0, 0, 255);">SET</span> <span style="color: rgb(0, 128, 0);">@StartDate</span> <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(0, 128, 0);">@StartDate</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span><br/>
<span style="color: rgb(0, 0, 255);">END</span><br/>
<br/>
<span style="color: rgb(0, 0, 255);">SELECT</span><span style="color: rgb(0, 0, 0);"> EmployeeKey,<br/>
       ParentEmployeeKey,<br/>
       EmployeeNationalIDAlternateKey,<br/>
       </span><span style="color: rgb(255, 0, 255);">CASE</span> <span style="color: rgb(0, 0, 255);">WHEN</span> <span style="color: rgb(255, 0, 255);">ISNULL</span>(MiddleName,<span style="color: rgb(255, 0, 0);">''</span>) <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(255, 0, 0);">''</span>  <span style="color: rgb(0, 0, 255);">THEN</span> FirstName <span style="color: rgb(128, 128, 128);">+</span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(128, 128, 128);">+</span><span style="color: rgb(0, 0, 0);"> LastName  <br/>
            </span><span style="color: rgb(0, 0, 255);">ELSE</span> FirstName <span style="color: rgb(128, 128, 128);">+</span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(128, 128, 128);">+</span> MiddleName <span style="color: rgb(128, 128, 128);">+</span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(128, 128, 128);">+</span><span style="color: rgb(0, 0, 0);">LastName<br/>
       </span><span style="color: rgb(0, 0, 255);">END</span> <span style="color: rgb(0, 0, 255);">AS</span><span style="color: rgb(0, 0, 0);"> FullName,<br/>
       Title <br/>
</span><span style="color: rgb(0, 0, 255);">INTO</span><span style="color: rgb(0, 0, 0);"> DimEmployee<br/>
</span><span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> AdventureWorksDW2012.dbo.DimEmployee<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span><span style="color: rgb(0, 0, 0);"> ProductKey,<br/>
       ProductAlternateKey,<br/>
       ProductSubcategoryKey,<br/>
       EnglishProductName,<br/>
       StandardCost,<br/>
       Color,<br/>
       SafetyStockLevel,<br/>
       ListPrice,<br/>
       Class,<br/>
       Size,<br/>
       StartDate,<br/>
       EndDate,<br/>
       </span><span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Status</span><span style="color: rgb(255, 0, 0);">]</span><span style="color: rgb(0, 0, 0);">,<br/>
       ProductAlternateKey </span><span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);"> (</span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 255);">CONVERT</span> (<span style="color: rgb(0, 0, 255);">Char</span>(<span style="color: rgb(128, 0, 0); font-weight: bold;">10</span>), StartDate, <span style="color: rgb(128, 0, 0); font-weight: bold;">120</span>) <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">'</span><span style="color: rgb(255, 0, 0);">)</span><span style="color: rgb(255, 0, 0);">'</span> <span style="color: rgb(0, 0, 255);">AS</span><span style="color: rgb(0, 0, 0);"> ProductID<br/>
</span><span style="color: rgb(0, 0, 255);">INTO</span><span style="color: rgb(0, 0, 0);"> DimProduct<br/>
</span><span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> AdventureWorksDW2012.dbo.DimProduct<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span><span style="color: rgb(0, 0, 0);"> ProductSubcategoryKey,<br/>
       ProductSubcategoryAlternateKey,<br/>
       EnglishProductSubcategoryName,<br/>
       ProductCategoryKey <br/>
</span><span style="color: rgb(0, 0, 255);">INTO</span><span style="color: rgb(0, 0, 0);"> DimProductSubcategory<br/>
</span><span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> AdventureWorksDW2012.dbo.DimProductSubcategory<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span><span style="color: rgb(0, 0, 0);"> ProductCategoryKey,<br/>
       ProductCategoryAlternateKey,<br/>
       EnglishProductCategoryName<br/>
</span><span style="color: rgb(0, 0, 255);">INTO</span><span style="color: rgb(0, 0, 0);"> DimProductCategory<br/>
</span><span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> AdventureWorksDW2012.dbo.DimProductCategory <br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span><span style="color: rgb(0, 0, 0);"> ProductKey,<br/>
       OrderDateKey,<br/>
       EmployeeKey,<br/>
       SalesOrderLineNumber,<br/>
       SalesOrderNumber,<br/>
       UnitPrice,<br/>
       ProductStandardCost,<br/>
       SalesAmount<br/>
</span><span style="color: rgb(0, 0, 255);">INTO</span><span style="color: rgb(0, 0, 0);"> FactResellerSales<br/>
</span><span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> AdventureWorksDW2012.dbo.FactResellerSales<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span><span style="color: rgb(0, 0, 0);"> ProductKey,<br/>
       OrderDateKey,<br/>
       DueDateKey,<br/>
       ShipDateKey,<br/>
       SalesOrderNumber,<br/>
       SalesOrderLineNumber,<br/>
       OrderQuantity,<br/>
       UnitPrice,<br/>
       SalesAmount<br/>
</span><span style="color: rgb(0, 0, 255);">INTO</span><span style="color: rgb(0, 0, 0);"> FactInternetSales<br/>
</span><span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> AdventureWorksDW2012.dbo.FactInternetSales<br/>
<br/>
</span><span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);">----------------------------------------------------------------------------</span><span style="color: rgb(0, 128, 128);"><br/>
--</span><span style="color: rgb(0, 128, 128);"> Add Primary Key Constraint</span><span style="color: rgb(0, 128, 128);"><br/>
--</span><span style="color: rgb(0, 128, 128);">----------------------------------------------------------------------------  </span><br/>
<span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimEmployee <br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> PK_EmployeeKey <span style="color: rgb(0, 0, 255);">PRIMARY</span> <span style="color: rgb(0, 0, 255);">KEY</span> <span style="color: rgb(0, 0, 255);">CLUSTERED</span><span style="color: rgb(0, 0, 0);"> (EmployeeKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimProduct <br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> PK_ProductKey <span style="color: rgb(0, 0, 255);">PRIMARY</span> <span style="color: rgb(0, 0, 255);">KEY</span> <span style="color: rgb(0, 0, 255);">CLUSTERED</span><span style="color: rgb(0, 0, 0);">(ProductKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimProductSubcategory <br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> PK_SubcategoryKey <span style="color: rgb(0, 0, 255);">PRIMARY</span> <span style="color: rgb(0, 0, 255);">KEY</span> <span style="color: rgb(0, 0, 255);">CLUSTERED</span><span style="color: rgb(0, 0, 0);">(ProductSubcategoryKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimProductCategory <br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> PK_CategoryKey <span style="color: rgb(0, 0, 255);">PRIMARY</span> <span style="color: rgb(0, 0, 255);">KEY</span> <span style="color: rgb(0, 0, 255);">CLUSTERED</span><span style="color: rgb(0, 0, 0);">(ProductCategoryKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactInternetSales <br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> PK_InternetSales <span style="color: rgb(0, 0, 255);">PRIMARY</span> <span style="color: rgb(0, 0, 255);">KEY</span> <span style="color: rgb(0, 0, 255);">CLUSTERED</span><span style="color: rgb(0, 0, 0);">(SalesOrderNumber,SalesOrderLineNumber)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactResellerSales <br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> PK_ResellerSales <span style="color: rgb(0, 0, 255);">PRIMARY</span> <span style="color: rgb(0, 0, 255);">KEY</span> <span style="color: rgb(0, 0, 255);">CLUSTERED</span><span style="color: rgb(0, 0, 0);">(SalesOrderNumber,SalesOrderLineNumber)<br/>
<br/>
</span><span style="color: rgb(0, 128, 128);">--</span><span style="color: rgb(0, 128, 128);">----------------------------------------------------------------------------</span><span style="color: rgb(0, 128, 128);"><br/>
--</span><span style="color: rgb(0, 128, 128);"> Add Primary Key Constraint</span><span style="color: rgb(0, 128, 128);"><br/>
--</span><span style="color: rgb(0, 128, 128);">----------------------------------------------------------------------------</span><br/>
<span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactResellerSales<br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Reseller_EmployeeKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span>(EmployeeKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimEmployee(EmployeeKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactResellerSales<br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Reseller_ProductKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span>(ProductKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimProduct(ProductKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactResellerSales<br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Reseller_OrderDateKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span>(OrderDateKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimDate(DateKey) <br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactInternetSales<br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Internet_ProductKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span>(ProductKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimProduct(ProductKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactInternetSales<br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Internet_OrderDateKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span>(OrderDateKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimDate(DateKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactInternetSales<br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Internet_ShipDateKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span>(ShipDateKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimDate(DateKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> FactInternetSales<br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Internet_DueDateKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span>(DueDateKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimDate(DateKey) <br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimProduct <br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Product_SubcatetoryKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span> (ProductSubcategoryKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimProductSubcategory (ProductSubcategoryKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">ALTER</span> <span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);"> DimProductSubcategory <br/>
</span><span style="color: rgb(0, 0, 255);">ADD</span> <span style="color: rgb(0, 0, 255);">CONSTRAINT</span> FK_Subcategory_CatetoryKey <span style="color: rgb(0, 0, 255);">FOREIGN</span> <span style="color: rgb(0, 0, 255);">KEY</span> (ProductCategoryKey) <span style="color: rgb(0, 0, 255);">REFERENCES</span><span style="color: rgb(0, 0, 0);"> DimProductCategory (ProductCategoryKey)<br/>
<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> DimEmployee <br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> DimDate <br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> DimProduct<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> DimProductSubcategory<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> DimProductCategory<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(0, 0, 255);">FROM</span><span style="color: rgb(0, 0, 0);"> FactResellerSales<br/>
</span><span style="color: rgb(0, 0, 255);">SELECT</span> <span style="color: rgb(128, 128, 128);">*</span> <span style="color: rgb(0, 0, 255);">FROM</span> FactInternetSales<br/></code></pre><h2 id="articleHeader3">案例设计</h2><p>下面可以看到维度表和事实表，其中包括了常用的时间维度，父子维度和雪花型维度的概念。另外要注意到 FactInternetSales 表中的 OrderDateKey, DueDateKey, ShipDateKey 都关联到了 DimDate 的主键 DateKey。 在后面有一个概念 Role-Playing Dimension 角色扮演维度就和这里的几个时间列有关。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151537-d115f75d2523421f80177f1e689d9a4b.png"/></p><p>创建数据源，数据源视图以及时间维度，父子维度，标准维度等过程就不再重复了，可以参照文章开头部分的几篇文章。</p><p>下面显示的是 Product 维度以及维度属性，同时有两个自定义的层次结构 Product by Category 和 Size by Color。</p><p><img alt="" height="567" src="http://images.cnitblog.com/blog/477275/201312/25151554-47ca5bca73154a668045bfc66a475afc.png" width="792"/></p><p>时间维度 - Date 以及两个自定义的属性层次结构 Calendar Date 和 Fiscal Date 。</p><p><img alt="" height="546" src="http://images.cnitblog.com/blog/477275/201312/25151606-9c9a8f5285844084ae75c7ce42de2b88.png" width="790"/></p><p>父子维度 Employee -</p><p><img alt="" height="529" src="http://images.cnitblog.com/blog/477275/201312/25151617-334e7eb14f7d4eff934fa70803cde800.png" width="788"/></p><p>创建完各个维度之后，我们将创建多维数据集 Cube。指定数据源视图 DSV_BIWORK，并选择事实表，这个向导将为每一个事实表创建一个度量值组，包含了由表中各列所创建的度量值。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151631-77b2e10cafaf4830b0d21f59e6494faa.png"/></p><p>有两个事实表，因此就有两个度量值组，并且向导将为非维度键的事实表中的每一个数值列创建一个度量值。由于我们这里不需要那么多，所以只选择部分度量值。另外要注意，度量值的名称源于事实表中的列，所有名称由可能相同。但是在多维数据集中，由于度量值的名称必须是唯一的，所以向导会在重复的度量值名称后添加所属的度量值组名称。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151648-808659a9ad8e4895a11e41ede496f886.png"/></p><p>下一步的时候多维数据集的向导识别了度量值组即之前的事实表与之相关的维度表，因此这里全部会显示出来。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151704-1685aa0abc62486a9b4d70e911ff7b5e.png"/></p><p>为多维数据集取一个名称并保存。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151713-e7bd22ed49b34440a04c88094339543a.png"/></p><p>可以看到在 Cube 文件夹中出现一个 BIWORK_FirstCube.cube ，这就是我们创建好的多维数据集。 最左侧能看到度量值组和度量值，左下侧可以看到多维数据集中的维度。</p><p><img alt="" height="377" src="http://images.cnitblog.com/blog/477275/201312/25151735-116edae9ced94691b08ec73c32bc9415.png" width="807"/></p><p>那么要注意到我们在数据库中的维度是 DimDate ，但是在多维数据集中就变成了三个时间维度 Order Date，Due Date 和 Ship Daet，这三个多维数据集维度就是角色扮演维度 Role-Playing Dimension。 因为它们本身就是 DimDate， 但是由于 FactInternetSales 中有三个时间列 OrderDateKey, DueDateKey 和 ShipDateKey 都关联到了 DimDate 表中的 DateKey。因此如果就只有一个 Date 时间维度，那么就分不清这个时间维度到底是指的 Order Date , Due Date 还是 Ship Date，这就是角色扮演维度的产生的原因。</p><p>角色扮演维度解释了数据库维度 Database Dimension 和多维数据集维度 Cube Dimension 的差异。一个维度的属性和数据包含在分析服务数据库中，这就是数据库维度。一个多维数据集可能包含一个或多个多维数据集维度，它引用了数据库维度的属性和数据。</p><p><img alt="" height="558" src="http://images.cnitblog.com/blog/477275/201312/25151752-f279cd0a35c644eba4562ab94d71513c.png" width="795"/></p><p>维度用法显示了各个多维数据集的维度是如何与度量值组进行关联的，交叉的内容显示了关联的维度属性。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151805-90cbd0339c1a45639f44e12b9331e3a2.png"/></p><p>部署这个项目然后到 Browser 浏览器中查看多维数据集，注意在 SQL Server 2012 版本中取消了之前在 SQL Server 2008 R2 版本中出现的能够显示多维数据的设计，而变成了在 SSRS 报表开发时的多维数据集的设计样式。 另外，添加了一个 Excel 连接，其实是要求开发者使用 Excel 在 Excel 中查看分析服务中多维数据集的数据。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151826-3d4f42cd752a49d29d4618bbcf5d45c7.png"/></p><p>部署完成后也可以到分析服务中查看多维数据集，左边可以看到数据库维度的 Date 维度，右边创建完一个 MDX 查询页面后可以看到多维数据集中的角色扮演维度以及其它维度，度量值组和度量值。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151842-8e9821af607648d5a4bfe703e96a014d.png"/></p><p>由于 Order Date 角色扮演维度在两个度量值组中同时出现，所以其实它就可以认为是 Date 维度，为了精简一下命名，可以先添加一个新的时间维度，然后再把 Order Date 维度给删除掉。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151856-d607dc0147614acfaabaf850aaa9a7f5.png"/></p><p>先添加一个时间维度。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151907-6f0a27227ede4286bc60224ab4b47fe4.png"/></p><p>可以看到与 FactResellerSales 的关联关系，是通过 OrderDateKey 进行关联的，同样的道理 FactInternetSales 也是这样关联的。</p><p><img alt="" height="406" src="http://images.cnitblog.com/blog/477275/201312/25151928-718a2532ec9e42d8a558e8e9205f8771.png" width="771"/></p><p>删除 Order Date 维度。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151946-296010dc35e44d3aa57e44e0d3f4e9b3.png"/></p><p>直接使用 Date 维度，这样名称更加简洁一下，它的作用和 Order Date 的作用是一样的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25151959-390e96051f1b4c66bc26d8522213d321.png"/></p><p>再次部署之后，我们就可以看到一个比较简洁的 Order Date 维度的替身 Date 维度了。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152012-7f5d3493997e4213944b22ba4c086dd9.png"/></p><p>可以在刚才看到的浏览器中打开 Excel  工具，在这里面就会自动加载多维数据集中的维度和度量值组。比如要查看 Internet Sales Amount 和 Reseller Sales Amount 在 Product Category 下的表现情况，那么就可以很容易的拖拽实现。</p><p><img alt="" height="707" src="http://images.cnitblog.com/blog/477275/201312/25152025-59e30de024904ce8b325cbd0d040047f.png" width="784"/></p><p>也可以通过 MDX 查询实现这样的效果，查询在 Product Category  成员下的 Internet Sales Amount 和 Reseller Sales Amount 的情况。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152050-3ae3641864cb4111a0a0ba2af6a7d451.png"/></p><p>但是在 MDX 查询中可以看到查询出来的结果并没有良好的格式化，因此回到开发设计中对度量值进行格式化，右键属性。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152103-44009c925bb0422ba9a521b8458cd751.png"/></p><p>Reseller Sales Amount - Format String - 输入下面的格式 ，同理 Internet Sales Amount 也这么选择，表示金额的格式。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152114-fdd85574f3794b6cb295069490fbda37.png"/></p><p>而对于 Reseller Sales Count, Order Quantity 和 Internet Sales Count 就只需要像下面这样设置就可以了。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152131-0474f5de8f0448cb9c2eeb771b30a105.png"/></p><p>重新部署之后在 MDX 中查询的结果 -</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152145-146328861457473dafab0b0a8c1f388e.png"/></p><p>在 Excel 中看到的结果 -</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152157-1a8ce9920ab04072a75616a202a92106.png"/></p><p>有的时候我们可能需要在 MDX 中做出这样的查询，即通过 Internet Sales Amount 和 Reseller Sales Amount 计算销售总额，会通过定义一个计算成员来实现。</p><pre><code><span style="font-family: Microsoft Yahei; font-size: 14px;"><span style="color: rgb(0, 0, 255);">WITH</span> MEMBER <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Sales Amount Total</span><span style="color: rgb(255, 0, 0);">]</span><br>
<span style="color: rgb(0, 0, 255);">AS</span><br/>
   <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Internet Sales Amount</span><span style="color: rgb(255, 0, 0);">]</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Reseller Sales Amount</span><span style="color: rgb(255, 0, 0);">]</span><br/>
,FORMAT_STRING <span style="color: rgb(128, 128, 128);">=</span>"$#,#"<br/>
<span style="color: rgb(0, 0, 255);">SELECT</span> {<br/>
        <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Internet Sales Amount</span><span style="color: rgb(255, 0, 0);">]</span>,<br/>
        <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Reseller Sales Amount</span><span style="color: rgb(255, 0, 0);">]</span>,<br/>
        <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Sales Amount Total</span><span style="color: rgb(255, 0, 0);">]</span><br/>
       } <span style="color: rgb(0, 0, 255);">ON</span> COLUMNS,<br/>
NON EMPTY(<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Product</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Category</span><span style="color: rgb(255, 0, 0);">]</span>.Members) <span style="color: rgb(0, 0, 255);">ON</span> ROWS<br/>
<span style="color: rgb(0, 0, 255);">FROM</span> <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">BIWORK_FirstCube</span><span style="color: rgb(255, 0, 0);">]</span></br></span></code></pre><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152212-895b34612510433f92a4882b7fe9ceb4.png"/></p><p>如果是我们自己开发的 SSRS 报表来查询数据没有问题，但是可能有很多时候客户会直接从 Excel 上去查询这些数据，那么我们可以先在设计度量值的时候将这些总额设计好。可以通过在多维数据集中在某一个维度(一般指的是度量值维度)上添加一个计算成员，将相关的计算公式直接存储在这个成员中。</p><p>在多维数据集设计器中选择计算 Calculations 并在 Script Organizer 的第一个 Command 下右键新建一个计算成员。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152226-1ef44f9157434eebbbe5f6696b683465.png"/></p><p>定义一个名称并注意需要带上方括号 [Sales Amount Total]，将两个度量值拖到 Expression 中，并在 Format string 中指定一个带字符串的金额格式。</p><p><img alt="" height="472" src="http://images.cnitblog.com/blog/477275/201312/25152253-f634ca2cbf67445e96392e94091d1086.png" width="763"/></p><p>部署项目并重新连接就能看到度量值组中多了一个计算成员，可以切换到代码模式，就能看到这个计算的成员的创建就已经在服务器端存在了，实际上这个创建计算成员的语法和我们在 MDX 查询的语法是一样的。</p><pre><code><span style="font-family: Microsoft Yahei; font-size: 14px;">CALCULATE; <br/>
<span style="color: rgb(0, 0, 255);">CREATE</span> MEMBER CURRENTCUBE.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Sales Amount Total</span><span style="color: rgb(255, 0, 0);">]</span><br/>
 <span style="color: rgb(0, 0, 255);">AS</span> <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Internet Sales Amount</span><span style="color: rgb(255, 0, 0);">]</span> <span style="color: rgb(128, 128, 128);">+</span> <span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Measures</span><span style="color: rgb(255, 0, 0);">]</span>.<span style="color: rgb(255, 0, 0);">[</span><span style="color: rgb(255, 0, 0);">Reseller Sales Amount</span><span style="color: rgb(255, 0, 0);">]</span>, <br/>
FORMAT_STRING <span style="color: rgb(128, 128, 128);">=</span> "$#,#", <br/>
VISIBLE <span style="color: rgb(128, 128, 128);">=</span> <span style="color: rgb(128, 0, 0); font-weight: bold;">1</span>  ;</span></code></pre><p><img alt="" height="342" src="http://images.cnitblog.com/blog/477275/201312/25152314-1998242657d84beb9048a5f00886f473.png" width="799"/></p><p>既然已经存在这个度量值计算成员了，那么就直接可以在 MDX 中查询了。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201312/25152327-7e08cdc63ada4bf69d985397e2f27ce7.png"/></p><p>并且在 Excel 中也可以直接使用这个计算成员了，当然对于使用者来说这就是一个度量值。</p><p><img alt="" height="230" src="http://images.cnitblog.com/blog/477275/201312/25152340-b620fe78bcc046189518d4d5a1cd3e28.png" width="777"/></p><p>在分析服务中创建计算成员一来可以提高计算成员(度量值)的重用性，二来这种常用的度量值计算成员放在一起也便于组织查看和管理，可以避免在各个客户端 MDX 查询中的计算成员创建的不统一，最后就是如果用户并不是使用我们自定义开发的报表，而是通过像 Excel 这种客户端的工具，常用的汇总计算成员事先定义好后面使用就很方便了。</p>
</div>]
</body>
</html>
