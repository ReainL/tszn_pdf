
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<h2 id="articleHeader1">开篇介绍</h2><p>SQL Server 2012 中提供了开发 SSAS 项目的两种模型，一种是新增加的 Tabular Model 表格模型，另一种就是原始的 Multidimensional Model 多维模型。</p><p>在这里演示的是 Multidimensional Model，如果要了解 Tabular Model 表格模型，请参看 - <a href="http://www.cnblogs.com/biwork/archive/2013/05/22/3093896.html"><u><font color="#0066cc">http://www.cnblogs.com/biwork/archive/2013/05/22/3093896.html</font></u></a></p><p>下面使用的环境是 VS2012 + SSDT 集成，可以参看 - <a href="http://www.flybi.net/blog/biwork/575">http://www.flybi.net/blog/biwork/575</a></p><p>数据库 AdventureWorks 可以到这里下载 - <a href="http://msftdbprodsamples.codeplex.com/releases/view/55330"><u><font color="#0066cc">http://msftdbprodsamples.codeplex.com/releases/view/55330</font></u></a></p><h2 id="articleHeader2">新建多维模型项目</h2><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214419-31f0cc6d16d8499e92bf96b97701fce3.png"/></p><h3 id="articleHeader3">创建数据源 </h3><p>数据源包含分析服务与源数据库连接时的信息。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214431-4248cd5fe4614da1b43156356da6ec65.png"/></p><p>新建数据源</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214437-0b96556d9b4049e2b79b9155f800a4e4.png"/></p><p>数据源的数据必须是关系型的数据源，并且分析服务可以从 SQL Server、 Access、Oracle 或其它 OLE DB/ODBC 驱动的数据库中读取数据。</p><p>选择 AdventureWorksDW2012</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214443-00e48e9f49cc4a28bd6078e42cf02a9c.png"/></p><p>Windows 用户名和密码</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214448-5bcdfbcd40514f5c8763d966013f3374.png"/></p><p> 数据源创建完成，指向本机 BIWORK 的 AdventureWorksDW2012 数据库。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214453-848d571c68414022adf718e9e4e83d1d.png"/></p><p> </p><h3 id="articleHeader4">数据源视图的创建</h3><p>数据源视图是物理数据库和分析服务维度与多维数据集之间的逻辑数据模型。在创建数据源视图的时候，需要在源数据库中指定我们所需要的表或者视图，这些表和视图是我们进行维度创建和分析的基础。</p><p>通常情况下，最好使用视图。这样即使源表结构有改动，也不需要重新修改数据源视图，这样对逻辑模型中的其它对象影响都会非常大。在本示例中，选择的仍然是表。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214503-b72d73cf007b4c73a6f698f95ae6c028.png"/></p><p>选择数据源</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214510-02d4dfe1f8ef4927807e77534275a9a8.png"/></p><p>在这个例子中只创建了有关 Internet Sales 相关的表对象，Fact 开头的是事实表，Dim 开头的是维度表。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214517-d9e7a0e1af4b4a149a1c6b122530ede6.png"/></p><p>那么这个数据源视图就包含了这么 5 张表，后面的维度设计和度量设计都是围绕着这 5 张表。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214524-4022934129f14c1a95d2f574a353f5ee.png"/></p><p>可以在创建好的数据源视图中看到这 5 张表的关系，很显然这是一个雪花型 Snowflake 模型，它也是 Star Scheme 星型模型的延伸。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214531-ca9ddf4f9c1d4a8abf02fc7e3d7c6f45.png"/></p><p>创建了数据源视图之后，根据需要可以做很多事情 -</p><ul><li>创建区域关系图，本示例中表数量较少，如果表数量多的情况下，可以根据主题选择相应的表逻辑性的将表与表之间的关系分开。</li><li>增加主键以及表之间的关系，有的表的元数据不完整，没有定义主键和表之间的关系，也可以在数据源视图中修改。</li><li>增加命名计算，可以根据已有列追加新的列，或者创建计算列，这个类似于 SQL Select 语句中根据已有列创建新的计算列。</li><li>还可以根据这些表创建命名查询表，比如关联 A 表和 B 表查询出来一个关联表然后保存在数据源视图对象中。</li></ul><p>在这里不演示上述操作，只对表名做出友好的命名操作。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214537-57520246c55544e6984ffe3eeb7189bf.png"/></p><p>取一个简单的名字</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214546-8a64b4071b8d488f9a1aa7b2416179da.png"/></p><p>每个表都改一下，看起来更加简洁一些。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214556-d3578b3d94d243b7be6b05e4b9fde0cf.png"/></p><p>数据源视图设计完毕后，就可以根据这些逻辑模型来创建最基础的维度和度量组了。</p><p>补充一点 - 在修改数据源视图的时候要注意：<strong><span style="color: rgb(255, 0, 0);">不能将命名计算添加到命名查询，也不能基于包含命名计算的表创建命名查询。</span></strong></p><h3 id="articleHeader5">维度的设计</h3><p>创建维度的时候首先应该要熟悉源表的数据以及它们之间的逻辑关系，下面只演示创建维度的过程。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214603-4b09a58f678d4f5690281381a264e875.png"/></p><p>使用已存在的表，注意还有其它选项，比如可以根据需要创建时间维度表 -</p><ol><li>可以从现有的表中创建时间维度。</li><li>可以向维度向导提供一个开始和结束日期，向导可以创建和填充关系型数据库，并生成该表的时间维度。</li><li>可以向维度向导提供一个开始和结束日期，向导将生成只存在于分析服务数据库中的时间维度。</li></ol><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214611-97cdc259caad4e98ae33c77d6a25f504.png"/></p><p>选择好刚创建的数据源是视图表，再选择 Date 表。这个表稍微有点特殊，目前可以说没有哪一个分析服务 OLAP 数据库中不使用到时间维度的。这里 Key Column 和 Name Column 先默认吧，之后可以改的。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214619-bb9ed5df3e8546228f92bab0af32a561.png"/></p><p>只选择勾中的列，并且注意在维度设计器中，我们对应的 Date 表中列在这里叫做 Dimension Attribute, Dimension Attribute 有 Attribute Name, Enable Browing 和 Attribute Type 可供操作。</p><p>注意到 Dimension Attribute 的 Attribute Name 实际上对应的就是数据源视图中 DimDate 表的列名，按字母开头给自然分开了。</p><p>Enable Browsing 在维度设计浏览中是否出现。</p><p>Attribute Type - Dimension Attribute 的每一个 Attribute 都会有这个。在时间维度的设计过程中，我们可以通过这个属性来指定每个属性所代表的时间单元，分析服务将通过设定好的时间单元来进行复杂的时间计算。 除此之外，分析服务还提供了会计，货币转换和地理等 Attribute Type。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214625-72114d8d6d0e444685b4a1b6e32103e2.png"/></p><p>时间属性修改之后的效果。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214632-c22ca86de83e4b6cb57674d91480694a.png"/></p><p>对比一下数据库中的源数据再来理解一下这样的设计。如果都是 Regular，那么 Date 维度中的属性值是什么就是什么，分析服务不会把 FullDateAlternateKey, EnglishMonthName, CalendarQuarter, CalendarSemester, CalendarYear 当作用来统计和计算数据的时间对象了。比如要统计 2005年第一个季度或者第一个月 January 的数据，比如上半年或者下半年的数据，那么通过对 Attribute Type 的修改，分析服务就知道 CalendarSemester = 1 的时候是指 1- 6 月。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214638-273617b6368c4038867c1cc81f2d64cf.png"/></p><p>第一个时间维度就设计完成了，再次注意在时间维度里，之前表中的列在这里叫做 Attribute, 这些 Attribute 有其它的属性来丰富它们各自的含义，比如像上面提到的有关时间的 Attribute Type 的设计。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214648-a6cb8b0e076140e4a4b38ac696f25a24.png"/></p><p>这样我们的第一个维度就算创建完成了，但是对于维度的创建和设计其实还有很多方面需要掌握 -</p><ul><li>通常情况下，应该掌握 3 种不同类型维度（标准，时间和父子维度）的创建方式。</li><li>创建完维度之后，通过维度设计器增强维度，比如修改属性层次结构，层次结构属性的排序，创建属性关系，设置默认成员，去除 ALL 级别等操作。</li></ul><h3 id="articleHeader6">多维数据集 Cube 的实现和维度的自动创建</h3><p>虽然上面只选择了一个时间维度表，但是可以通过创建多维数据集将其它相关的维度也给同时创建出来。</p><p>在创建 Cube 的过程中，有一个很重要的对象将会出现，它就是度量值(组)。我们要做的事情就是把维度和度量值组中的数据在多维数据集中组合起来，这样我们就可以大致通过维度来观察不同角度下的数据。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214656-1866fc2601a04ca8a1bd53c042e16f4e.png"/></p><p>使用已存在的表，这里的表还是从数据源视图中选择。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214704-9f2c5699b472491f996bcd17615ed2f3.png"/></p><p>在创建 Cube 的时候，其实就是从数据源视图中引入所有相关的事实表 Fact Table 和维度表 Dimension Table, 所以所有的事实表和维度表都必须包含在这个数据源视图中。并且，对于每一个事实表，在这个过程中都会创建一个相应的度量值组，包含了由事实表中各个选择出来的列所创建的度量值。</p><p>所以下面它首先要选择的是 Measure Group Tables - 度量值组表。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214713-e487ebea0b8041c6ba349af6a792b794.png"/></p><p>Measures - 选择度量值，只选择需要的度量值。可以把这里的 Internet Sales 看作是视图中的表，下面的 Measure 都是表中的列，实际上也就是这么来转换的。</p><p>要注意的是，Cube 多维数据集中必须包含一个度量值组，而一个度量值组中必须包含一个度量值。简单可以理解就是必须要有一个事实表，事实表中必要要有一列。</p><p>但是它们之间还是有着很大的区别，Measure Group 和 Measure 的概念只在 Cube 中存在而不是关系型数据库中的表和列。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214721-dd22077e1cf94516918bf05258da2541.png"/></p><p>选择已创建好的维度。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214727-c6422828365c460389ad481159730fa4.png"/></p><p>由于数据源视图中，可以看到事实表和其它维度表之间存在着直接或者间接的关系 （Snowflake 雪花型模型）。因此在这里都会关联起来，当然也可以不选择这些维度，但通常情况下还是要选择的。</p><p>注意到 Geography 是通过 Customer 关联的，还有对于事实表 Internet Sales 来说，也会为它创建一个维度，这个有事实表构成的维度就叫做事实维度。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214733-6faf61f2a62c48cc8cc454ff2c372618.png"/></p><p>多维数据集 Cube 由 Measure Groups 度量值组和 Dimensions 维度组成。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214739-e328f2cba84d49438dc68f49b2221659.png"/></p><p>在这里可以看到最原始的数据源视图，创建的度量值组以及维度。</p><h3 id="articleHeader7">角色扮演维度 Role-Playing Dimension</h3><p>要注意的是，在多维数据集中显示了三个维度，但是我们并没有创建过。它们是 Order Date, Ship Date 和 Due Date，这个一会再来看。</p><p><img alt="" height="523" src="http://images.cnitblog.com/blog/477275/201308/22214753-a9b95d4d79b2426f8fe98a7ae80f27ef.png" width="976"/></p><p>修改维度，增加维度属性。由于在创建 Cube 时选择的事实表只有相关的外键关联到这些维度表，因此创建完维度之后，默认情况下也就只为维度创建了这些维度属性，比如 Customer 中的 Customer Key 和 Geography Key。 但事实上，只有这两者是不够的，需要继续添加新的维度属性，这些都是我们看数据（度量值）的“角度”。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214812-bf8eeaae4cf84f27acb49cba96c70269.png"/></p><p>在 VS2012 或者 SSDT 中非常方便的就可以直接拖拉过去，如果需要修改命名的话，可以修改属性。</p><p><img alt="" height="438" src="http://images.cnitblog.com/blog/477275/201308/22214821-0c0806ea9fb74ccbb0d1a428784a5fce.png" width="828"/></p><p>这是 Product 维度属性的修改</p><p><img alt="" height="420" src="http://images.cnitblog.com/blog/477275/201308/22214837-c4bc76842db84afdaf12394ddb8f7f9d.png" width="826"/></p><p> </p><p>再来看这三个维度 Due Date, Order Date 和 Ship Date。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214937-479535e35fb54bf48da82823409cca86.png"/></p><p>实际上这里的三个维度仍然表示的是时间维度 Date, 只不过在时间维度与度量值的关联过程中依次有三个纬度属性与之相关联。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/26223440-48cd2bbf9e924f6b99c8d702471dc8d1.png"/></p><p>而每一个 Date 无论是 Due Date, Ship Date 或是 Order Date 都应该具有相同的 Date 维度属性 -</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/26223626-99a78a9b51274ad39e959215624713fd.png"/></p><p>如果放在一起，试问又该如何区分这里的 Calendary Quarter 究竟是指 Order Date 还是 Ship Date 呢？因此就在这里将它们区分开来，它们都具有 Date 维度相同的属性。这是用我们最简单的思考方式来解释 Cube 中的维度为什么要这么来操作，它们又如何存在的。</p><p><strong><span style="color: rgb(255, 0, 0);">实际上，这三个维度有一个专有的名字 - Role Playing Dimension 角色扮演或者角色模仿维度。</span></strong></p><p><strong><span style="color: rgb(255, 0, 0);">角色模仿维度在这里就清晰的告诉了我们数据库维度 Database Dimension 和多维数据集维度 Cube Dimension 之间的差异。</span></strong></p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/26224321-001d1edddef24fc4956aab691c6c1a56.png"/></p><p><strong><span style="color: rgb(255, 0, 0);">数据库维度中我们能看到的只有 Date, Customer, Product 和 Internet Sales 这几个维度。但是在多维数据集维度中，数据库维度 Date 扮演了三个不同的维度角色，Role Date, Order Date 和 Ship Date。</span></strong></p><p><strong><span style="color: rgb(255, 0, 0);">一个多维数据集可能包含一个或者多个数据库维度，它引用了数据库维度中的属性和数据，必要的时候会通过角色扮演维度来更好的维护和管理维度和度量值组之间的关系。</span></strong></p><h3 id="articleHeader8">部署 Cube </h3><p>最后部署到本机来查看一下创建好的多维数据集 Cube。</p><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/22214954-a6dc6dda13f34c7d8929e96df3466146.png"/></p><p>部署成功后，能看到 SSAS 数据库中的各个对象 -</p><ul><li>数据源</li><li>数据源视图</li><li>多维数据集对象 Cube 与度量值组</li><li>数据库维度 - 此时数据库维度中的 Date 在 Cube 中扮演了 Due Date, Order Date 和 Ship Date 这三个多维数据集维度，这三个多维数据集维度具有 Date 维度中相同的结构</li></ul><p><img alt="" src="http://images.cnitblog.com/blog/477275/201308/26225501-a48bece90ee14320a9a9e636e7013258.png"/><br/></p>
</div>]
</body>
</html>
