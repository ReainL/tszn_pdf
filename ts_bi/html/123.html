
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
[<div class="message-content editor-style">
<p>先直接看一个例子 -</p><pre><code><span style="font-family: 'Microsoft Yahei';"><span style="color: #0000ff;">WITH</span><br/>
MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 vs 2005 Bad</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">AS</span><br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">2006</span><span style="color: #ff0000;">]</span> <span style="color: #808080;">/</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">2005</span><span style="color: #ff0000;">]</span>,<br/>
FORMAT_STRING <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">Percent</span><span style="color: #ff0000;">'</span><br/>
<span style="color: #0000ff;">SELECT</span><br/>
{<br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">2005</span><span style="color: #ff0000;">]</span>,<br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">2006</span><span style="color: #ff0000;">]</span>,<br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 vs 2005 Bad</span><span style="color: #ff0000;">]</span><br/>
} <span style="color: #808080;">*</span><br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Reseller Sales Amount</span><span style="color: #ff0000;">]</span> <span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">0</span>,<br/>
{ <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Sales Territory</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Sales Territory</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Country</span><span style="color: #ff0000;">]</span>.MEMBERS}<br/>
<span style="color: #0000ff;">ON</span> <span style="color: #800000; font-weight: bold;">1</span><br/>
<span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Adventure Works</span><span style="color: #ff0000;">]</span></span></code></pre><p><img alt="" src="http://images.cnitblog.com/blog/477275/201310/23213157-069dc1728e5e4c7a8fdcf6c7b874af0b.png"/></p><p>首先在 Data 维度 [Calendar Year] 层次结构中定义一个计算成员 [CY 2006 vs 2005 Bad]，因为默认的度量值是 [Reseller Sales Amount]，因此表达式中的 [Date].[Calendar Year].[Calendar Year].&amp;[2006] /[Date].[Calendar Year].[Calendar Year].&amp;[2005] 表示的意思就是 2006 年零售额与 2005年零售额的比。</p><p>然后按 Country 分别来显示 2005年，2006年的销售额以及 2006年与2005年的销售额比。</p><p>为了在 SSRS 中显示，必须对这个代码做出一些改造 -</p><pre><code><span style="font-family: 'Microsoft Yahei';"><span style="color: #0000ff;">WITH</span><br/>
<span style="color: #008080;">--</span><span style="color: #008080;"> CY 2005 Reseller Sales Amount</span><br/>
MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2005 Reseller Sales Amount</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">AS</span><br/>
(<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">2005</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Reseller Sales Amount</span><span style="color: #ff0000;">]</span>)<br/>
<br/>
<span style="color: #008080;">--</span><span style="color: #008080;"> CY 2006 Reseller Sales Amount</span><br/>
MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 Reseller Sales Amount</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">AS</span><br/>
(<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Date</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Calendar Year</span><span style="color: #ff0000;">]</span>.<span style="color: #808080;">&amp;</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">2006</span><span style="color: #ff0000;">]</span>,<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Reseller Sales Amount</span><span style="color: #ff0000;">]</span>)<br/>
<br/>
<span style="color: #008080;">--</span><span style="color: #008080;"> CY 2006 VS CY 2005</span><br/>
MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 vs 2005 Bad</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">AS</span><br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 Reseller Sales Amount</span><span style="color: #ff0000;">]</span> <span style="color: #808080;">/</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2005 Reseller Sales Amount</span><span style="color: #ff0000;">]</span>,<br/>
FORMAT_STRING <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">Percent</span><span style="color: #ff0000;">'</span><br/>
<br/>
<span style="color: #0000ff;">SELECT</span> {<br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2005 Reseller Sales Amount</span><span style="color: #ff0000;">]</span>,<br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 Reseller Sales Amount</span><span style="color: #ff0000;">]</span>,<br/>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 vs 2005 Bad</span><span style="color: #ff0000;">]</span><br/>
   } <span style="color: #0000ff;">ON</span> COLUMNS,<br/>
   { <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Sales Territory</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Sales Territory</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Country</span><span style="color: #ff0000;">]</span>.MEMBERS} <span style="color: #0000ff;">ON</span> ROWS<br/>
<span style="color: #0000ff;">FROM</span> <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Adventure Works</span><span style="color: #ff0000;">]</span>;</span></code></pre><p><img alt="" src="http://images.cnitblog.com/blog/477275/201310/23213303-bf4c1d3430334577aec2ab80e8ae98eb.png"/></p><p>从上面两个例子中查询结果来看，因为 CY 2005 中有一些 Reseller Sales Amount 是没有记录的，因此造成显示结果出现了 1.#INF 或者是 Infinity，这就是在除法运算的过程中分母为零的问题。</p><p>为了解决这样的问题，应该在除法元算的过程中添加条件判断。</p><pre><code><span style="font-family: 'Microsoft Yahei';">MEMBER <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 vs 2005 Bad</span><span style="color: #ff0000;">]</span><br/>
<span style="color: #0000ff;">AS</span><br/>
     IIF(<span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2005 Reseller Sales Amount</span><span style="color: #ff0000;">]</span> <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">0</span> , <span style="color: #0000ff;">NULL</span>,          <span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2006 Reseller Sales Amount</span><span style="color: #ff0000;">]</span> <span style="color: #808080;">/</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">Measures</span><span style="color: #ff0000;">]</span>.<span style="color: #ff0000;">[</span><span style="color: #ff0000;">CY 2005 Reseller Sales Amount</span><span style="color: #ff0000;">]</span>),<br/>
FORMAT_STRING <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">Percent</span><span style="color: #ff0000;">'</span></span></code></pre><p><img alt="" src="http://images.cnitblog.com/blog/477275/201310/23213418-0184232e41ef4fa48ab143081c38c997.png"/> </p><p>为 NULL 的结果在 SSRS Report 上不会显示 -</p><p> <img alt="" src="http://images.cnitblog.com/blog/477275/201310/23213432-4e990f3bb3ba4934b1c78a27be4c5af4.png"/></p>
</div>]
</body>
</html>
